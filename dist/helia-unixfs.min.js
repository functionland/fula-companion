!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.HeliaUnixfs=t()}("undefined"!=typeof self?self:this,(function(){"use strict";var e=(()=>{var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),a=(e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:!0})},l=(e,i,o,a)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let l of r(i))!s.call(e,l)&&l!==o&&t(e,l,{get:()=>i[l],enumerable:!(a=n(i,l))||a.enumerable});return e},u=(n,r,s)=>(s=null!=n?e(i(n)):{},l(!r&&n&&n.__esModule?s:t(s,"default",{value:n,enumerable:!0}),n)),h=o(((e,t)=>{function n(e,t){for(let n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}t.exports=function(e,t,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof t&&(r=t,t=""),t&&(r.code=t);try{return n(e,r)}catch{r.message=e.message,r.stack=e.stack;let t=function(){};return t.prototype=Object.create(Object.getPrototypeOf(e)),n(new t,r)}}})),c=o(((e,t)=>{!function(n,r){var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function l(e){return e=o(e^=e>>>16,2246822507),(e=o(e^=e>>>13,3266489909))^e>>>16}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function c(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function f(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function d(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=d(e,[0,e[0]>>>1]),e=d(e=h(e,[4283543511,3981806797]),[0,e[0]>>>1]),d(e=h(e,[3301882366,444984403]),[0,e[0]>>>1])}i.x86.hash32=function(e,t){if(i.inputValidation&&!s(e))return r;t=t||0;for(var n=e.length%4,u=e.length-n,h=t,c=0,f=3432918353,d=461845907,p=0;p<u;p+=4)c=o(c=e[p]|e[p+1]<<8|e[p+2]<<16|e[p+3]<<24,f),c=o(c=a(c,15),d),h=o(h=a(h^=c,13),5)+3864292196;switch(c=0,n){case 3:c^=e[p+2]<<16;case 2:c^=e[p+1]<<8;case 1:c=o(c^=e[p],f),h^=c=o(c=a(c,15),d)}return(h=l(h^=e.length))>>>0},i.x86.hash128=function(e,t){if(i.inputValidation&&!s(e))return r;t=t||0;for(var n=e.length%16,u=e.length-n,h=t,c=t,f=t,d=t,p=0,y=0,w=0,g=0,m=597399067,b=2869860233,v=951274213,k=2716044179,_=0;_<u;_+=16)p=e[_]|e[_+1]<<8|e[_+2]<<16|e[_+3]<<24,y=e[_+4]|e[_+5]<<8|e[_+6]<<16|e[_+7]<<24,w=e[_+8]|e[_+9]<<8|e[_+10]<<16|e[_+11]<<24,g=e[_+12]|e[_+13]<<8|e[_+14]<<16|e[_+15]<<24,p=a(p=o(p,m),15),h=a(h^=p=o(p,b),19),h=o(h+=c,5)+1444728091,y=a(y=o(y,b),16),c=a(c^=y=o(y,v),17),c=o(c+=f,5)+197830471,w=a(w=o(w,v),17),f=a(f^=w=o(w,k),15),f=o(f+=d,5)+2530024501,g=a(g=o(g,k),18),d=a(d^=g=o(g,m),13),d=o(d+=h,5)+850148119;switch(p=0,y=0,w=0,g=0,n){case 15:g^=e[_+14]<<16;case 14:g^=e[_+13]<<8;case 13:g=o(g^=e[_+12],k),d^=g=o(g=a(g,18),m);case 12:w^=e[_+11]<<24;case 11:w^=e[_+10]<<16;case 10:w^=e[_+9]<<8;case 9:w=o(w^=e[_+8],v),f^=w=o(w=a(w,17),k);case 8:y^=e[_+7]<<24;case 7:y^=e[_+6]<<16;case 6:y^=e[_+5]<<8;case 5:y=o(y^=e[_+4],b),c^=y=o(y=a(y,16),v);case 4:p^=e[_+3]<<24;case 3:p^=e[_+2]<<16;case 2:p^=e[_+1]<<8;case 1:p=o(p^=e[_],m),h^=p=o(p=a(p,15),b)}return h^=e.length,h+=c^=e.length,h+=f^=e.length,c+=h+=d^=e.length,f+=h,d+=h,h=l(h),h+=c=l(c),h+=f=l(f),c+=h+=d=l(d),f+=h,d+=h,("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)},i.x64.hash128=function(e,t){if(i.inputValidation&&!s(e))return r;t=t||0;for(var n=e.length%16,o=e.length-n,a=[0,t],l=[0,t],y=[0,0],w=[0,0],g=[2277735313,289559509],m=[1291169091,658871167],b=0;b<o;b+=16)y=[e[b+4]|e[b+5]<<8|e[b+6]<<16|e[b+7]<<24,e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24],w=[e[b+12]|e[b+13]<<8|e[b+14]<<16|e[b+15]<<24,e[b+8]|e[b+9]<<8|e[b+10]<<16|e[b+11]<<24],y=c(y=h(y,g),31),a=u(a=c(a=d(a,y=h(y,m)),27),l),a=u(h(a,[0,5]),[0,1390208809]),w=c(w=h(w,m),33),l=u(l=c(l=d(l,w=h(w,g)),31),a),l=u(h(l,[0,5]),[0,944331445]);switch(y=[0,0],w=[0,0],n){case 15:w=d(w,f([0,e[b+14]],48));case 14:w=d(w,f([0,e[b+13]],40));case 13:w=d(w,f([0,e[b+12]],32));case 12:w=d(w,f([0,e[b+11]],24));case 11:w=d(w,f([0,e[b+10]],16));case 10:w=d(w,f([0,e[b+9]],8));case 9:w=h(w=d(w,[0,e[b+8]]),m),l=d(l,w=h(w=c(w,33),g));case 8:y=d(y,f([0,e[b+7]],56));case 7:y=d(y,f([0,e[b+6]],48));case 6:y=d(y,f([0,e[b+5]],40));case 5:y=d(y,f([0,e[b+4]],32));case 4:y=d(y,f([0,e[b+3]],24));case 3:y=d(y,f([0,e[b+2]],16));case 2:y=d(y,f([0,e[b+1]],8));case 1:y=h(y=d(y,[0,e[b]]),g),a=d(a,y=h(y=c(y,31),m))}return a=u(a=d(a,[0,e.length]),l=d(l,[0,e.length])),l=u(l,a),a=u(a=p(a),l=p(l)),l=u(l,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)},typeof e<"u"?(typeof t<"u"&&t.exports&&(e=t.exports=i),e.murmurHash3=i):"function"==typeof define&&define.amd?define([],(function(){return i})):(i._murmurHash3=n.murmurHash3,i.noConflict=function(){return n.murmurHash3=i._murmurHash3,i._murmurHash3=r,i.noConflict=r,i},n.murmurHash3=i)}(e)})),f=o(((e,t)=>{t.exports=c()})),d=o(((e,t)=>{function n(e,t){return e+r(t)}function r(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function i(e,t){return e[0]-t[0]}function s(e){return e[1]}t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(void 0===t)-1!==n&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let r=!1;-1===n?(n=this._data.length,this._setBit(e),this._changedData=!0):r=!0,this._setInternalPos(n,e,t,r),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();let t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){let e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,r=t;for(;n<this.length;)r=e(r,this.get(n),n),n++;return r}find(e){let t,n,r=0;for(;r<this.length&&!t;)n=this.get(r),t=e(n),r++;return t?n:void 0}_internalPositionFor(e,t){let i=this._bytePosFor(e,t);if(i>=this._bitArrays.length)return-1;let s=this._bitArrays[i],o=e-7*i;return(s&1<<o)>0?this._bitArrays.slice(0,i).reduce(n,0)+r(s&~(4294967295<<o+1))-1:-1}_bytePosFor(e,t){let n=Math.floor(e/7),r=n+1;for(;!t&&this._bitArrays.length<r;)this._bitArrays.push(0);return n}_setBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){let t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,n,r){let i=this._data,s=[t,n];if(r)this._sortData(),i[e]=s;else{if(i.length)if(i[i.length-1][0]>=t)i.push(s);else if(i[0][0]<=t)i.unshift(s);else{let e=Math.round(i.length/2);this._data=i.slice(0,e).concat(s).concat(i.slice(e))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(i),this._changedData=!1}bitField(){let e,t=[],n=8,r=0,i=0,s=this._bitArrays.slice();for(;s.length||r;){0===r&&(e=s.shift(),r=7);let o=Math.min(r,n);i|=(e&~(255<<o))<<8-n,e>>>=o,r-=o,n-=o,(!n||!r&&!s.length)&&(t.push(i),i=0,n=8)}for(var o=t.length-1;o>0&&0===t[o];o--)t.pop();return t}compactArray(){return this._sortData(),this._data.map(s)}}})),p=o(((e,t)=>{var n=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,i||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),l.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},l.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},l.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var l,u,h=this._events[a],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,i),!0;case 5:return h.fn.call(h.context,t,n,i,s),!0;case 6:return h.fn.call(h.context,t,n,i,s,o),!0}for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var f,d=h.length;for(u=0;u<d;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),c){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,n);break;case 4:h[u].fn.call(h[u].context,t,n,i);break;default:if(!l)for(f=1,l=new Array(c-1);f<c;f++)l[f-1]=arguments[f];h[u].fn.apply(h[u].context,l)}}return!0},l.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!n||o.context===n)&&a(this,s);else{for(var l=0,u=[],h=o.length;l<h;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,typeof t<"u"&&(t.exports=l)})),y=o(((e,t)=>{t.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}})),w=o(((e,t)=>{var n=y(),{hasOwnProperty:r}=Object.prototype,{propertyIsEnumerable:i}=Object,s=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0}),o=e,a={concatArrays:!1,ignoreUndefined:!1},l=e=>{let t=[];for(let n in e)r.call(e,n)&&t.push(n);if(Object.getOwnPropertySymbols){let n=Object.getOwnPropertySymbols(e);for(let r of n)i.call(e,r)&&t.push(r)}return t};function u(e){return Array.isArray(e)?function(e){let t=e.slice(0,0);return l(e).forEach((n=>{s(t,n,u(e[n]))})),t}(e):n(e)?function(e){let t=null===Object.getPrototypeOf(e)?Object.create(null):{};return l(e).forEach((n=>{s(t,n,u(e[n]))})),t}(e):e}var h=(e,t,n,r)=>(n.forEach((n=>{typeof t[n]>"u"&&r.ignoreUndefined||(n in e&&e[n]!==Object.getPrototypeOf(e)?s(e,n,f(e[n],t[n],r)):s(e,n,u(t[n])))})),e),c=(e,t,n)=>{let i=e.slice(0,0),o=0;return[e,t].forEach((t=>{let a=[];for(let n=0;n<t.length;n++)r.call(t,n)&&(a.push(String(n)),s(i,o++,t===e?t[n]:u(t[n])));i=h(i,t,l(t).filter((e=>!a.includes(e))),n)})),i};function f(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?c(e,t,r):n(t)&&n(e)?h(e,t,l(t),r):u(t)}t.exports=function(...e){let t=f(u(a),this!==o&&this||{},a),r={_:{}};for(let i of e)if(void 0!==i){if(!n(i))throw new TypeError("`"+i+"` is not an Option Object");r=f(r,{_:i},t)}return r._}})),g=o(((e,t)=>{var n=1e3,r=6e4,i=60*r,s=24*i,o=7*s;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}t.exports=function(e,t){t=t||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===l&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=s?a(e,t,s,"day"):t>=i?a(e,t,i,"hour"):t>=r?a(e,t,r,"minute"):t>=n?a(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=s?Math.round(e/s)+"d":t>=i?Math.round(e/i)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}})),m=o(((e,t)=>{t.exports=function(e){function t(e){let r,i,s,o=null;function a(...e){if(!a.enabled)return;let n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;let s=t.formatters[i];if("function"==typeof s){let t=e[o];r=s.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,n){let r=t(this.namespace+(typeof n>"u"?":":n)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];let n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=g(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}})),b=o(((e,t)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch{}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch{}}(),e.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=m()(e);var{formatters:n}=t.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),v={};a(v,{globSource:()=>ja,unixfs:()=>Ga,urlSource:()=>Va});var k=u(h(),1),_=function(e){if(function(e){return null!=e[Symbol.asyncIterator]}(e))return(async()=>{for await(let t of e)return t})();for(let t of e)return t},x=function(e,t=1){return t=Number(t),function(e){return null!=e[Symbol.asyncIterator]}(e)?async function*(){let n=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(let r of e)for(n.push(r);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length>0;)yield n.slice(0,t),n=n.slice(t)}():function*(){let n=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(let r of e)for(n.push(r);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length>0;)yield n.slice(0,t),n=n.slice(t)}()};async function*E(e,t=1){for await(let n of x(e,t)){let e=n.map((async e=>e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){let n=await e[t];if(!n.ok)throw n.err;yield n.value}}}function S(e=0){return new Uint8Array(e)}function N(e=0){return new Uint8Array(e)}function B(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));let n=N(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return n}function C(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}var I=Symbol.for("@achingbrain/uint8arraylist");function A(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let n=0;for(let r of e){let e=n+r.byteLength;if(t<e)return{buf:r,index:t-n};n=e}throw new RangeError("index is out of bounds")}function T(e){return!!e?.[I]}var z=class e{bufs;length;[I]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else{if(!T(n))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.push(...n.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else{if(!T(n))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.unshift(...n.bufs)}this.length+=t}get(e){let t=A(this.bufs,e);return t.buf[t.index]}set(e,t){let n=A(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else{if(!T(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let n=0;n<e.length;n++)this.set(t+n,e.get(n))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){let{bufs:n,length:r}=this._subList(e,t);return B(n,r)}subarray(e,t){let{bufs:n,length:r}=this._subList(e,t);return 1===n.length?n[0]:B(n,r)}sublist(t,n){let{bufs:r,length:i}=this._subList(t,n),s=new e;return s.length=i,s.bufs=[...r],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],r=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],o=r,a=o+s.byteLength;if(r=a,e>=a)continue;let l=e>=o&&e<a,u=t>o&&t<=a;if(l&&u){if(e===o&&t===a){n.push(s);break}let r=e-o;n.push(s.subarray(r,r+(t-e)));break}if(l){if(0===e){n.push(s);continue}n.push(s.subarray(e-o))}else{if(u){if(t===a){n.push(s);break}n.push(s.subarray(0,t-o));break}n.push(s)}}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!(T(e)||e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;let r=n.byteLength;if(0===r)throw new TypeError("search must be at least 1 byte long");let i=new Int32Array(256);for(let e=0;e<256;e++)i[e]=-1;for(let e=0;e<r;e++)i[n[e]]=e;let s,o=i,a=this.byteLength-n.byteLength,l=n.byteLength-1;for(let e=t;e<=a;e+=s){s=0;for(let t=l;t>=0;t--){let r=this.get(e+t);if(n[t]!==r){s=Math.max(1,t-o[r]);break}}if(0===s)return e}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=N(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let r=S(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt16(0,t,n),this.write(r,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let r=S(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt32(0,t,n),this.write(r,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let r=S(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigInt64(0,t,n),this.write(r,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=N(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let r=S(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint16(0,t,n),this.write(r,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let r=S(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint32(0,t,n),this.write(r,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let r=S(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigUint64(0,t,n),this.write(r,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let r=S(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat32(0,t,n),this.write(r,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let r=S(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat64(0,t,n),this.write(r,e)}equals(t){if(null==t||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!C(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,n){let r=new e;return r.bufs=t,null==n&&(n=t.reduce(((e,t)=>e+t.byteLength),0)),r.length=n,r}},D=(e={})=>{let t=e.chunkSize??262144;return async function*(e){let n=new z,r=0,i=!1;for await(let s of e)for(n.append(s),r+=s.length;r>=t;)if(yield n.slice(0,t),i=!0,t===n.length)n=new z,r=0;else{let e=new z;e.append(n.sublist(t)),n=e,r-=t}(!i||r>0)&&(yield n.subarray(0,r))}},L={};a(L,{code:()=>ft,createLink:()=>ht,createNode:()=>ut,decode:()=>pt,encode:()=>dt,name:()=>ct,prepare:()=>at,validate:()=>lt});var P={};a(P,{base32:()=>ee,base32hex:()=>ie,base32hexpad:()=>oe,base32hexpadupper:()=>ae,base32hexupper:()=>se,base32pad:()=>ne,base32padupper:()=>re,base32upper:()=>te,base32z:()=>le});var U={};a(U,{coerce:()=>M,empty:()=>F,equals:()=>O,fromHex:()=>R,fromString:()=>V,isBinary:()=>j,toHex:()=>$,toString:()=>H});var F=new Uint8Array(0);function $(e){return e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),"")}function R(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map((e=>parseInt(e,16)))):F}function O(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}function M(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function j(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function V(e){return(new TextEncoder).encode(e)}function H(e){return(new TextDecoder).decode(e)}var G=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=i}var a=e.length,l=e.charAt(0),u=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function c(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===l;)r++,t++;for(var s=(e.length-t)*u+1>>>0,o=new Uint8Array(s);e[t];){var h=n[e.charCodeAt(t)];if(255===h)return;for(var c=0,f=s-1;(0!==h||c<i)&&-1!==f;f--,c++)h+=a*o[f]>>>0,o[f]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");i=c,t++}if(" "!==e[t]){for(var d=s-i;d!==s&&0===o[d];)d++;for(var p=new Uint8Array(r+(s-d)),y=r;d!==s;)p[y++]=o[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,s=t.length;i!==s&&0===t[i];)i++,n++;for(var o=(s-i)*h+1>>>0,u=new Uint8Array(o);i!==s;){for(var c=t[i],f=0,d=o-1;(0!==c||f<r)&&-1!==d;d--,f++)c+=256*u[d]>>>0,u[d]=c%a>>>0,c=c/a>>>0;if(0!==c)throw new Error("Non-zero carry");r=f,i++}for(var p=o-r;p!==o&&0===u[p];)p++;for(var y=l.repeat(n);p<o;++p)y+=e.charAt(u[p]);return y},decodeUnsafe:c,decode:function(e){var n=c(e);if(n)return n;throw new Error(`Non-${t} character`)}}},W=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},q=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return K(this,e)}},X=class{decoders;constructor(e){this.decoders=e}or(e){return K(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function K(e,t){return new X({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var J=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new W(e,t,n),this.decoder=new q(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Y({name:e,prefix:t,encode:n,decode:r}){return new J(e,t,n,r)}function Q({name:e,prefix:t,alphabet:n}){let{encode:r,decode:i}=G(n,e);return Y({prefix:t,name:e,encode:r,decode:e=>M(i(e))})}function Z({name:e,prefix:t,bitsPerChar:n,alphabet:r}){return Y({prefix:t,name:e,encode:e=>function(e,t,n){let r="="===t[t.length-1],i=(1<<n)-1,s="",o=0,a=0;for(let r=0;r<e.length;++r)for(a=a<<8|e[r],o+=8;o>n;)o-=n,s+=t[i&a>>o];if(0!==o&&(s+=t[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s}(e,r,n),decode:t=>function(e,t,n,r){let i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let o=new Uint8Array(s*n/8|0),a=0,l=0,u=0;for(let t=0;t<s;++t){let s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${r} character`);l=l<<n|s,a+=n,a>=8&&(a-=8,o[u++]=255&l>>a)}if(a>=n||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o}(t,r,n,e)})}var ee=Z({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),te=Z({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ne=Z({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),re=Z({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ie=Z({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),se=Z({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oe=Z({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ae=Z({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),le=Z({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ue={};a(ue,{base58btc:()=>he,base58flickr:()=>ce});var he=Q({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ce=Q({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),fe=128,de=-128,pe=Math.pow(2,31),ye=128,we=127,ge=Math.pow(2,7),me=Math.pow(2,14),be=Math.pow(2,21),ve=Math.pow(2,28),ke=Math.pow(2,35),_e=Math.pow(2,42),xe=Math.pow(2,49),Ee=Math.pow(2,56),Se=Math.pow(2,63),Ne={encode:function e(t,n,r){n=n||[];for(var i=r=r||0;t>=pe;)n[r++]=255&t|fe,t/=128;for(;t&de;)n[r++]=255&t|fe,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},decode:function e(t,n){var r,i=0,s=0,o=n=n||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[o++],i+=s<28?(r&we)<<s:(r&we)*Math.pow(2,s),s+=7}while(r>=ye);return e.bytes=o-n,i},encodingLength:function(e){return e<ge?1:e<me?2:e<be?3:e<ve?4:e<ke?5:e<_e?6:e<xe?7:e<Ee?8:e<Se?9:10}},Be=Ne;function Ce(e,t=0){return[Be.decode(e,t),Be.decode.bytes]}function Ie(e,t,n=0){return Be.encode(e,t,n),t}function Ae(e){return Be.encodingLength(e)}function Te(e,t){let n=t.byteLength,r=Ae(e),i=r+Ae(n),s=new Uint8Array(i+n);return Ie(e,s,0),Ie(n,s,r),s.set(t,i),new De(e,n,t,s)}function ze(e){let t=M(e),[n,r]=Ce(t),[i,s]=Ce(t.subarray(r)),o=t.subarray(r+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new De(n,i,o,t)}var De=class{code;size;digest;bytes;constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}};function Le(e,t){let{bytes:n,version:r}=e;return 0===r?function(e,t,n){let{prefix:r}=n;if(r!==he.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);let i=t.get(r);if(null==i){let i=n.encode(e).slice(1);return t.set(r,i),i}return i}(n,Ue(e),t??he.encoder):function(e,t,n){let{prefix:r}=n,i=t.get(r);if(null==i){let i=n.encode(e);return t.set(r,i),i}return i}(n,Ue(e),t??ee.encoder)}var Pe=new WeakMap;function Ue(e){let t=Pe.get(e);if(null==t){let t=new Map;return Pe.set(e,t),t}return t}var Fe=class e{code;version;multihash;bytes;"/";constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:n}=this;if(t!==$e)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(n.code!==Re)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(n)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:n}=this.multihash,r=Te(t,n);return e.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(e,t){let n=t;return null!=n&&e.code===n.code&&e.version===n.version&&function(e,t){if(e===t)return!0;{let n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&O(e.bytes,n.bytes)}}(e.multihash,n.multihash)}toString(e){return Le(this,e)}toJSON(){return{"/":Le(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;let n=t;if(n instanceof e)return n;if(null!=n["/"]&&n["/"]===n.bytes||n.asCID===n){let{version:t,code:r,multihash:i,bytes:s}=n;return new e(t,r,i,s??Oe(t,r,i.bytes))}if(!0===n[Me]){let{version:t,multihash:r,code:i}=n,s=ze(r);return e.create(t,i,s)}return null}static create(t,n,r){if("number"!=typeof n)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:if(n!==$e)throw new Error(`Version 0 CID must use dag-pb (code: ${$e}) block encoding`);return new e(t,n,r,r.bytes);case 1:{let i=Oe(t,n,r.bytes);return new e(t,n,r,i)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,$e,t)}static createV1(t,n){return e.create(1,t,n)}static decode(t){let[n,r]=e.decodeFirst(t);if(0!==r.length)throw new Error("Incorrect length");return n}static decodeFirst(t){let n=e.inspectBytes(t),r=n.size-n.multihashSize,i=M(t.subarray(r,r+n.multihashSize));if(i.byteLength!==n.multihashSize)throw new Error("Incorrect length");let s=i.subarray(n.multihashSize-n.digestSize),o=new De(n.multihashCode,n.digestSize,s,i);return[0===n.version?e.createV0(o):e.createV1(n.codec,o),t.subarray(n.size)]}static inspectBytes(e){let t=0,n=()=>{let[n,r]=Ce(e.subarray(t));return t+=r,n},r=n(),i=$e;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);let s=t,o=n(),a=n(),l=t+a;return{version:r,codec:i,multihashCode:o,digestSize:a,multihashSize:l-s,size:l}}static parse(t,n){let[r,i]=function(e,t){switch(e[0]){case"Q":{let n=t??he;return[he.prefix,n.decode(`${he.prefix}${e}`)]}case he.prefix:{let n=t??he;return[he.prefix,n.decode(e)]}case ee.prefix:{let n=t??ee;return[ee.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(t,n),s=e.decode(i);if(0===s.version&&"Q"!==t[0])throw Error("Version 0 CID string must not include multibase prefix");return Ue(s).set(r,t),s}},$e=112,Re=18;function Oe(e,t,n){let r=Ae(e),i=r+Ae(t),s=new Uint8Array(i+n.byteLength);return Ie(e,s,0),Ie(t,s,r),s.set(n,i),s}var Me=Symbol.for("@ipld/js-cid/CID"),je=new TextDecoder;function Ve(e,t){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");let i=e[t++];if(n+=r<28?(127&i)<<r:(127&i)*2**r,i<128)break}return[n,t]}function He(e,t){let n;[n,t]=Ve(e,t);let r=t+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,r),r]}function Ge(e,t){let n;return[n,t]=Ve(e,t),[7&n,n>>3,t]}function We(e){let t={},n=e.length,r=0;for(;r<n;){let n,i;if([n,i,r]=Ge(e,r),1===i){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,r]=He(e,r)}else if(2===i){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,r]=He(e,r),t.Name=je.decode(i)}else{if(3!==i)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Tsize`);[t.Tsize,r]=Ve(e,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return t}var qe=new TextEncoder,Xe=2**32,Ke=2**31;function Je(e,t){let n=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");n=Qe(t,n,e.Tsize)-1,t[n]=24}if("string"==typeof e.Name){let r=qe.encode(e.Name);n-=r.length,t.set(r,n),n=Qe(t,n,r.length)-1,t[n]=18}return e.Hash&&(n-=e.Hash.length,t.set(e.Hash,n),n=Qe(t,n,e.Hash.length)-1,t[n]=10),t.length-n}function Ye(e){let t=0;if(e.Hash){let n=e.Hash.length;t+=1+n+Ze(n)}if("string"==typeof e.Name){let n=qe.encode(e.Name).length;t+=1+n+Ze(n)}return"number"==typeof e.Tsize&&(t+=1+Ze(e.Tsize)),t}function Qe(e,t,n){let r=t-=Ze(n);for(;n>=Ke;)e[t++]=127&n|128,n/=128;for(;n>=128;)e[t++]=127&n|128,n>>>=7;return e[t]=n,r}function Ze(e){return e%2==0&&e++,Math.floor((function(e){let t=0;return e>=Xe&&(e=Math.floor(e/Xe),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+et[e]}(e)+6)/7)}var et=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],tt=["Data","Links"],nt=["Hash","Name","Tsize"],rt=new TextEncoder;function it(e,t){if(e===t)return 0;let n=e.Name?rt.encode(e.Name):[],r=t.Name?rt.encode(t.Name):[],i=n.length,s=r.length;for(let e=0,t=Math.min(i,s);e<t;++e)if(n[e]!==r[e]){i=n[e],s=r[e];break}return i<s?-1:s<i?1:0}function st(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function ot(e){if("object"==typeof e.asCID){let t=Fe.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(e.Hash){let n=Fe.asCID(e.Hash);try{n||("string"==typeof e.Hash?n=Fe.parse(e.Hash):e.Hash instanceof Uint8Array&&(n=Fe.decode(e.Hash)))}catch(e){throw new TypeError(`Invalid DAG-PB form: ${e.message}`)}n&&(t.Hash=n)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function at(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");let t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=rt.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(ot),t.Links.sort(it)}else t.Links=[];return t}function lt(e){if(!e||"object"!=typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!st(e,tt))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){let n=e.Links[t];if(!n||"object"!=typeof n||Array.isArray(n)||n instanceof Uint8Array||n["/"]&&n["/"]===n.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!st(n,nt))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==n.Hash||!n.Hash["/"]||n.Hash["/"]!==n.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!=typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize){if("number"!=typeof n.Tsize||n.Tsize%1!=0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(n.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===it(n,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function ut(e,t=[]){return at({Data:e,Links:t})}function ht(e,t,n){return ot({Hash:n,Name:e,Tsize:t})}var ct="dag-pb",ft=112;function dt(e){lt(e);let t={};return e.Links&&(t.Links=e.Links.map((e=>{let t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),function(e){let t=function(e){let t=0;if(e.Data){let n=e.Data.length;t+=1+n+Ze(n)}if(e.Links)for(let n of e.Links){let e=Ye(n);t+=1+e+Ze(e)}return t}(e),n=new Uint8Array(t),r=t;if(e.Data&&(r-=e.Data.length,n.set(e.Data,r),r=Qe(n,r,e.Data.length)-1,n[r]=10),e.Links)for(let t=e.Links.length-1;t>=0;t--){let i=Je(e.Links[t],n.subarray(0,r));r-=i,r=Qe(n,r,i)-1,n[r]=18}return n}(t)}function pt(e){let t=function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e),n=function(e){let t,n,r=e.length,i=0,s=!1;for(;i<r;){let r,o;if([r,o,i]=Ge(e,i),2!==r)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${r}`);if(1===o){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,i]=He(e,i),t&&(s=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(s)throw new Error("protobuf: (PBNode) duplicate Links section");let n;t||(t=[]),[n,i]=He(e,i),t.push(We(n))}}}if(i>r)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return n&&(o.Data=n),o.Links=t||[],o}(t),r={};return n.Data&&(r.Data=n.Data),n.Links&&(r.Links=n.Links.map((e=>{let t={};try{t.Hash=Fe.decode(e.Hash)}catch{}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r}var yt=u(h(),1),wt=Math.pow(2,7),gt=Math.pow(2,14),mt=Math.pow(2,21),bt=Math.pow(2,28),vt=Math.pow(2,35),kt=Math.pow(2,42),_t=Math.pow(2,49),xt=128,Et=127;function St(e){if(e<wt)return 1;if(e<gt)return 2;if(e<mt)return 3;if(e<bt)return 4;if(e<vt)return 5;if(e<kt)return 6;if(e<_t)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Nt(e,t,n=0){switch(St(e)){case 8:t[n++]=255&e|xt,e/=128;case 7:t[n++]=255&e|xt,e/=128;case 6:t[n++]=255&e|xt,e/=128;case 5:t[n++]=255&e|xt,e/=128;case 4:t[n++]=255&e|xt,e>>>=7;case 3:t[n++]=255&e|xt,e>>>=7;case 2:t[n++]=255&e|xt,e>>>=7;case 1:t[n++]=255&e,e>>>=7;break;default:throw new Error("unreachable")}return t}var Bt=new Float32Array([-0]),Ct=new Uint8Array(Bt.buffer);function It(e,t,n){Bt[0]=e,t[n]=Ct[0],t[n+1]=Ct[1],t[n+2]=Ct[2],t[n+3]=Ct[3]}var At=new Float64Array([-0]),Tt=new Uint8Array(At.buffer);function zt(e,t,n){At[0]=e,t[n]=Tt[0],t[n+1]=Tt[1],t[n+2]=Tt[2],t[n+3]=Tt[3],t[n+4]=Tt[4],t[n+5]=Tt[5],t[n+6]=Tt[6],t[n+7]=Tt[7]}var Dt=BigInt(Number.MAX_SAFE_INTEGER),Lt=BigInt(Number.MIN_SAFE_INTEGER),Pt=class e{lo;hi;constructor(e,t){this.lo=0|e,this.hi=0|t}toNumber(e=!1){if(!e&&this.hi>>>31>0){let e=1+~this.lo>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=1+~this.lo>>>0,t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(t){if(0n===t)return Ut;if(t<Dt&&t>Lt)return this.fromNumber(Number(t));let n=t<0n;n&&(t=-t);let r=t>>32n,i=t-(r<<32n);return n&&(r=0n|~r,i=0n|~i,++i>Ft&&(i=0n,++r>Ft&&(r=0n))),new e(Number(i),Number(r))}static fromNumber(t){if(0===t)return Ut;let n=t<0;n&&(t=-t);let r=t>>>0,i=(t-r)/4294967296>>>0;return n&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new e(r,i)}static from(t){return"number"==typeof t?e.fromNumber(t):"bigint"==typeof t?e.fromBigInt(t):"string"==typeof t?e.fromBigInt(BigInt(t)):null!=t.low||null!=t.high?new e(t.low>>>0,t.high>>>0):Ut}},Ut=new Pt(0,0);Ut.toBigInt=function(){return 0n},Ut.zzEncode=Ut.zzDecode=function(){return this},Ut.length=function(){return 1};var Ft=4294967296n;function $t(e,t,n){let r,i,s=n;for(let s=0;s<e.length;++s)r=e.charCodeAt(s),r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-s}function Rt(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function Ot(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Mt=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Rt(this,10);return e}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw Rt(this,4);return Ot(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Rt(this,4);return 0|Ot(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw Rt(this,4);let e=function(e,t){return Ct[0]=e[t],Ct[1]=e[t+1],Ct[2]=e[t+2],Ct[3]=e[t+3],Bt[0]}(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Rt(this,4);let e=function(e,t){return Tt[0]=e[t],Tt[1]=e[t+1],Tt[2]=e[t+2],Tt[3]=e[t+3],Tt[4]=e[t+4],Tt[5]=e[t+5],Tt[6]=e[t+6],Tt[7]=e[t+7],At[0]}(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Rt(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return function(e,t,n){if(n-t<1)return"";let r,i,s=[],o=0;for(;t<n;)i=e[t++],i<128?s[o++]=i:i>191&&i<224?s[o++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((r??(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return null!=r?(o>0&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))}(e,0,e.length)}skip(e){if("number"==typeof e){if(this.pos+e>this.len)throw Rt(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Rt(this)}while(128&this.buf[this.pos++]);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Pt(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw Rt(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Rt(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Rt(this,8);let e=Ot(this.buf,this.pos+=4),t=Ot(this.buf,this.pos+=4);return new Pt(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=function(e,t){let n=e[t],r=0;if(r+=n&Et,n<xt||(n=e[t+1],r+=(n&Et)<<7,n<xt)||(n=e[t+2],r+=(n&Et)<<14,n<xt)||(n=e[t+3],r+=(n&Et)<<21,n<xt)||(n=e[t+4],r+=(n&Et)*bt,n<xt)||(n=e[t+5],r+=(n&Et)*vt,n<xt)||(n=e[t+6],r+=(n&Et)*kt,n<xt)||(n=e[t+7],r+=(n&Et)*_t,n<xt))return r;throw new RangeError("Could not decode varint")}(this.buf,this.pos);return this.pos+=St(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function jt(e,t,n){let r=function(e){return new Mt(e instanceof Uint8Array?e:e.subarray())}(e);return t.decode(r,void 0,n)}var Vt={};a(Vt,{base10:()=>Ht});var Ht=Q({prefix:"9",name:"base10",alphabet:"0123456789"}),Gt={};a(Gt,{base16:()=>Wt,base16upper:()=>qt});var Wt=Z({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qt=Z({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Xt={};a(Xt,{base2:()=>Kt});var Kt=Z({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Jt={};a(Jt,{base256emoji:()=>en});var Yt=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Qt=Yt.reduce(((e,t,n)=>(e[n]=t,e)),[]),Zt=Yt.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]),en=Y({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+Qt[t]),"")},decode:function(e){let t=[];for(let n of e){let e=Zt[n.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}}),tn={};a(tn,{base36:()=>nn,base36upper:()=>rn});var nn=Q({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),rn=Q({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),sn={};a(sn,{base64:()=>on,base64pad:()=>an,base64url:()=>ln,base64urlpad:()=>un});var on=Z({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),an=Z({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ln=Z({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),un=Z({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),hn={};a(hn,{base8:()=>cn});var cn=Z({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fn={};a(fn,{identity:()=>dn});var dn=Y({prefix:"\0",name:"identity",encode:e=>H(e),decode:e=>V(e)}),pn=(new TextEncoder,new TextDecoder),yn=512,wn={};a(wn,{code:()=>mn,decode:()=>vn,encode:()=>bn,name:()=>gn});var gn="raw",mn=85;function bn(e){return M(e)}function vn(e){return M(e)}a({},{identity:()=>_n});var kn=M,_n={code:0,name:"identity",encode:kn,digest:function(e){return Te(0,kn(e))}};function xn({name:e,code:t,encode:n}){return new En(e,t,n)}a({},{sha256:()=>Nn,sha512:()=>Bn});var En=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Te(this.code,t):t.then((e=>Te(this.code,e)))}throw Error("Unknown type, must be binary type")}};function Sn(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var Nn=xn({name:"sha2-256",code:18,encode:Sn("SHA-256")}),Bn=xn({name:"sha2-512",code:19,encode:Sn("SHA-512")}),Cn={...fn,...Xt,...hn,...Vt,...Gt,...P,...tn,...ue,...sn,...Jt};function In(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}var An=In("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),Tn=In("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{let t=N((e=e.substring(1)).length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),zn={utf8:An,"utf-8":An,hex:Cn.base16,latin1:Tn,ascii:Tn,binary:Tn,...Cn};function Dn(e,t="utf8"){let n=zn[t];if(null==n)throw new Error(`Unsupported encoding "${t}"`);return n.decoder.decode(`${n.prefix}${e}`)}var Ln=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function Pn(){}var Un=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},Fn=function(){let e,t=8192,n=t;return function(r){if(r<1||r>4096)return N(r);n+r>t&&(e=N(t),n=0);let i=e.subarray(n,n+=r);return 7&n&&(n=1+(7|n)),i}}(),$n=class{len;head;tail;states;constructor(){this.len=0,this.head=new Ln(Pn,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Ln(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Wn((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(qn,10,Pt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Pt.fromBigInt(e);return this._push(qn,t.length(),t)}uint64Number(e){return this._push(Nt,St(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Pt.fromBigInt(e).zzEncode();return this._push(qn,t.length(),t)}sint64Number(e){let t=Pt.fromNumber(e).zzEncode();return this._push(qn,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Rn,1,e?1:0)}fixed32(e){return this._push(Xn,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Pt.fromBigInt(e);return this._push(Xn,4,t.lo)._push(Xn,4,t.hi)}fixed64Number(e){let t=Pt.fromNumber(e);return this._push(Xn,4,t.lo)._push(Xn,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(It,4,e)}double(e){return this._push(zt,8,e)}bytes(e){let t=e.length>>>0;return 0===t?this._push(Rn,1,0):this.uint32(t)._push(Kn,t,e)}string(e){let t=function(e){let t=0,n=0;for(let r=0;r<e.length;++r)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t}(e);return 0!==t?this.uint32(t)._push($t,t,e):this._push(Rn,1,0)}fork(){return this.states=new Un(this),this.head=this.tail=new Ln(Pn,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ln(Pn,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),0!==n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=(r=this.len,null!=globalThis.Buffer?N(r):Fn(r)),n=0;for(var r;null!=e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function Rn(e,t,n){t[n]=255&e}function On(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}var Mn,jn,Vn,Hn,Gn,Wn=class extends Ln{next;constructor(e,t){super(On,e,t),this.next=void 0}};function qn(e,t,n){for(;0!==e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function Xn(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Kn(e,t,n){t.set(e,n)}function Jn(e,t,n){t.set(e,n)}function Yn(e,t,n){e.length<40?$t(e,t,n):null!=t.utf8Write?t.utf8Write(e,n):t.set(Dn(e),n)}function Qn(e,t){let n=new $n;return t.encode(e,n,{lengthDelimited:!1}),n.finish()}function Zn(e,t,n,r){return{name:e,type:t,encode:n,decode:r}}function er(e,t){return Zn("message",Mn.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&($n.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(Jn,t,e),this},$n.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(Yn,t,e),this}),(jn=Mn||(Mn={}))[jn.VARINT=0]="VARINT",jn[jn.BIT64=1]="BIT64",jn[jn.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",jn[jn.START_GROUP=3]="START_GROUP",jn[jn.END_GROUP=4]="END_GROUP",jn[jn.BIT32=5]="BIT32",function(e){let t;var n;let r,i;(n=t=e.DataType||(e.DataType={})).Raw="Raw",n.Directory="Directory",n.File="File",n.Metadata="Metadata",n.Symlink="Symlink",n.HAMTShard="HAMTShard",function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(r||(r={})),function(e){e.codec=()=>function(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return Zn("enum",Mn.VARINT,(function(e,n){let r=t(e);n.int32(r)}),(function(e){return t(e.int32())}))}(r)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==i&&(i=er(((t,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),null!=t.Type&&(n.uint32(8),e.DataType.codec().encode(t.Type,n)),null!=t.Data&&(n.uint32(18),n.bytes(t.Data)),null!=t.filesize&&(n.uint32(24),n.uint64(t.filesize)),null!=t.blocksizes)for(let e of t.blocksizes)n.uint32(32),n.uint64(e);null!=t.hashType&&(n.uint32(40),n.uint64(t.hashType)),null!=t.fanout&&(n.uint32(48),n.uint64(t.fanout)),null!=t.mode&&(n.uint32(56),n.uint32(t.mode)),null!=t.mtime&&(n.uint32(66),Hn.codec().encode(t.mtime,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{let r={blocksizes:[]},i=null==n?t.len:t.pos+n;for(;t.pos<i;){let n=t.uint32();switch(n>>>3){case 1:r.Type=e.DataType.codec().decode(t);break;case 2:r.Data=t.bytes();break;case 3:r.filesize=t.uint64();break;case 4:r.blocksizes.push(t.uint64());break;case 5:r.hashType=t.uint64();break;case 6:r.fanout=t.uint64();break;case 7:r.mode=t.uint32();break;case 8:r.mtime=Hn.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return r}))),i),e.encode=t=>Qn(t,e.codec()),e.decode=t=>jt(t,e.codec())}(Vn||(Vn={})),function(e){let t;e.codec=()=>(null==t&&(t=er(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{let n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Qn(t,e.codec()),e.decode=t=>jt(t,e.codec())}(Hn||(Hn={})),function(e){let t;e.codec=()=>(null==t&&(t=er(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{let n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){let t=e.uint32();t>>>3==1?n.MimeType=e.string():e.skipType(7&t)}return n}))),t),e.encode=t=>Qn(t,e.codec()),e.decode=t=>jt(t,e.codec())}(Gn||(Gn={}));var tr={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},nr=["directory","hamt-sharded-directory"],rr=parseInt("0644",8),ir=parseInt("0755",8),sr=class e{static unmarshal(t){let n=Vn.decode(t),r=new e({type:tr[null!=n.Type?n.Type.toString():"File"],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:null!=n.mtime?{secs:n.mtime.Seconds??0n,nsecs:n.mtime.FractionalNanoseconds}:void 0,fanout:n.fanout});return r._originalMode=n.mode??0,r}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){let{type:t,data:n,blockSizes:r,hashType:i,fanout:s,mtime:o,mode:a}=e;if(null!=t&&!Object.values(tr).includes(t))throw(0,yt.default)(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t??"file",this.data=n,this.hashType=i,this.fanout=s,this.blockSizes=r??[],this._originalMode=0,this.mode=a,this.mtime=o}set mode(e){this._mode=null==e?this.isDirectory()?ir:rr:4095&e}get mode(){return this._mode}isDirectory(){return nr.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Vn.DataType.Raw;break;case"directory":e=Vn.DataType.Directory;break;case"file":e=Vn.DataType.File;break;case"metadata":e=Vn.DataType.Metadata;break;case"symlink":e=Vn.DataType.Symlink;break;case"hamt-sharded-directory":e=Vn.DataType.HAMTShard;break;default:throw(0,yt.default)(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let t,n,r=this.data;return(null==this.data||0===this.data.length)&&(r=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(this.mode??0),t===rr&&!this.isDirectory()&&(t=void 0),t===ir&&this.isDirectory()&&(t=void 0)),null!=this.mtime&&(n={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Vn.encode({Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:n})}},or=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}},ar=async(e,t,n)=>{null==n.codec&&(n.codec=L);let r=await Nn.digest(e),i=Fe.create(n.cidVersion,n.codec.code,r);return await t.put(i,e,n),i};function lr(e){return async function*(t,n){let r=0n;for await(let i of t.content)yield async()=>{let s,o={codec:L,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(o.codec=wn,o.cidVersion=1):(s=new sr({type:e.leafType,data:i}),i=dt({Data:s.marshal(),Links:[]}));let a=await ar(i,n,o);return r+=BigInt(i.byteLength),e.onProgress?.(new or("unixfs:importer:progress:file:write",{bytesWritten:r,cid:a,path:t.path})),{cid:a,unixfs:s,size:BigInt(i.length),block:i}}}}var ur=u(h(),1),hr=async(e,t,n)=>{let r=new sr({type:"directory",mtime:e.mtime,mode:e.mode}),i=dt(at({Data:r.marshal()}));return{cid:await ar(i,t,n),path:e.path,unixfs:r,size:BigInt(i.length),originalPath:e.originalPath,block:i}};function cr(e){return!0===e.single}var fr=async(e,t,n)=>n.layout(async function*(e,t,n){let r,i=-1;for await(let s of E(n.bufferImporter(e,t),n.blockWriteConcurrency))i++,0!==i?(1===i&&null!=r&&(yield{...r,block:void 0,single:void 0},r=void 0),yield{...s,block:void 0}):r={...s,single:!0};null!=r&&(yield r)}(e,t,n),((e,t,n)=>async function(r){if(1===r.length&&cr(r[0])&&n.reduceSingleLeafToSelf){let i=r[0],s=i.block;return cr(i)&&(void 0!==e.mtime||void 0!==e.mode)&&(i.unixfs=new sr({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=dt(at(s)),i.cid=await ar(i.block,t,{...n,cidVersion:n.cidVersion}),i.size=BigInt(i.block.length)),n.onProgress?.(new or("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}let i=new sr({type:"file",mtime:e.mtime,mode:e.mode}),s=r.filter((e=>e.cid.code===mn&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n||!!e.unixfs?.data?.length)).map((e=>e.cid.code===mn?(i.addBlockSize(e.size),{Name:"",Tsize:Number(e.size),Hash:e.cid}):(null==e.unixfs||null==e.unixfs.data?i.addBlockSize(e.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid}))),o={Data:i.marshal(),Links:s},a=dt(at(o)),l=await ar(a,t,n);return n.onProgress?.(new or("unixfs:importer:progress:file:layout",{cid:l,path:e.originalPath})),{cid:l,path:e.path,unixfs:i,size:BigInt(a.length+o.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),originalPath:e.originalPath,block:a}})(e,t,n));function dr(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(function(e){return Symbol.iterator in e}(e))return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw(0,ur.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw(0,ur.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function pr(e){return null!=e.content}var yr=u(h(),1),wr=()=>async function*(e){for await(let t of e){if(void 0===t.length)throw(0,yr.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"==typeof t||t instanceof String)yield Dn(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw(0,yr.default)(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}},gr=174;function mr(e){let t=e?.maxChildrenPerNode??gr;return async function e(n,r){let i=[];for await(let e of x(n,t))i.push(await r(e));return i.length>1?e(i,r):i[0]}}var br=function(e){if(function(e){return null!=e[Symbol.asyncIterator]}(e))return(async()=>{let t=[];for await(let n of e)t.push(n);return t})();let t=[];for(let n of e)t.push(n);return t},vr=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},kr=Fe.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),_r=Fe.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),xr=class extends vr{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(let[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;this.nodeSize=0;for(let[e,t]of this._children.entries())null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?_r.bytes.byteLength:kr.bytes.byteLength));return this.nodeSize}async*flush(e){let t=[];for(let[n,r]of this._children.entries()){let i=r;if(r instanceof vr)for await(let t of r.flush(e))i=t,yield t;null!=i.size&&null!=i.cid&&t.push({Name:n,Tsize:Number(i.size),Hash:i.cid})}let n=new sr({type:"directory",mtime:this.mtime,mode:this.mode}),r={Data:n.marshal(),Links:t},i=dt(at(r)),s=await ar(i,e,this.options),o=i.length+r.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=s,this.size=o,yield{cid:s,unixfs:n,path:this.path,size:BigInt(o)}}},Er=u(f(),1);xn({name:"murmur3-32",code:35,encode:e=>function(e){let t=new Array(4);for(let n=0;n<4;n++)t[n]=255&e,e>>=8;return new Uint8Array(t)}(Er.default.x86.hash32(e))});var Sr=xn({name:"murmur3-128",code:34,encode:e=>U.fromHex(Er.default.x64.hash128(e))}),Nr=(xn({name:"murmur3-x64-64",code:34,encode:e=>U.fromHex(Er.default.x64.hash128(e)).subarray(0,8)}),u(d(),1)),Br=class e{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new Nr.default,this.key=null}async put(e,t){let n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)}async get(e){let t=await this._findChild(e);if(null!=t)return t.value}async del(e){let t=await this._findPlace(e),n=t.bucket._at(t.pos);null!=n&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((t,n)=>n instanceof e?t+n.leafCount():t+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let t=this._children.compactArray();for(let n of t)n instanceof e?yield*n.eachLeafSeries():yield n}serialize(t,n){return n(this._children.reduce(((r,i,s)=>(null!=i&&(i instanceof e?r.push(i.serialize(t,n)):r.push(t(i,s))),r)),[]))}async asyncTransform(e,t){return Tr(this,e,t)}toJSON(){return this.serialize(Ir,Ar)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){let n=await this._findPlace(t),r=n.bucket._at(n.pos);if(!(r instanceof e)&&null!=r&&r.key===t)return r}async _findPlace(t){let n=this._options.hash("string"==typeof t?Dn(t):t),r=await n.take(this._options.bits),i=this._children.get(r);return i instanceof e?i._findPlace(n):{bucket:this,pos:r,hash:n,existingChild:i}}async _findNewBucketAndPos(t){let n=await this._findPlace(t);if(null!=n.existingChild&&n.existingChild.key!==t){let t=new e(this._options,n.bucket,n.pos);n.bucket._putObjectAt(n.pos,t);let r=await t._findPlace(n.existingChild.hash);return r.bucket._putAt(r,n.existingChild.key,n.existingChild.value),t._findNewBucketAndPos(n.hash)}return n}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){let t=this._children.find(Cr);if(null!=t&&!(t instanceof e)){let e=t.hash;e.untake(this._options.bits);let n={pos:this._posAtParent,hash:e,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}};function Cr(e){return!!e}function Ir(e,t){return e.key}function Ar(e){return e}async function Tr(e,t,n){let r=[];for(let i of e._children.compactArray())if(i instanceof Br)await Tr(i,t,n);else{let n=await t(i);r.push({bitField:e._children.bitField(),children:n})}return n(r)}var zr=[255,254,252,248,240,224,192,128],Dr=[1,3,7,15,31,63,127,255],Lr=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],r=this._currentBitPos+1,i=Math.min(r,t);n=(n<<i)+Pr(e,r-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Pr(e,t,n){let r=function(e,t){return zr[e]&Dr[Math.min(t+e-1,7)]}(t,n);return(e&r)>>>t}function Ur(e){return function(t){return t instanceof Fr?t:new Fr(t,e)}}var Fr=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t);n=(n<<r)+e.take(r),t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?B([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Lr(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function $r(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");let t={bits:e.bits??8,hash:Ur(e.hashFn)};return new Br(t)}async function Rr(e){return(await Sr.encode(e)).slice(0,8).reverse()}var Or=BigInt(34),Mr=class extends vr{_bucket;constructor(e,t){super(e,t),this._bucket=$r({hashFn:Rr,bits:t.shardFanoutBits??8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=Hr(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(let t of jr(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*jr(e,t,n,r){let i=e._children,s=(e.tableSize()-1).toString(16).length,o=[],a=0n;for(let e=0;e<i.length;e++){let n=i.get(e);if(null==n)continue;let l=e.toString(16).toUpperCase().padStart(s,"0");if(n instanceof Br){let e;for await(let i of jr(n,t,null,r))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:l,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else if(Vr(n.value)){let e,r=n.value;for await(let n of r.flush(t))e=n,yield e;if(null==e)throw new Error("Did not flush dir");let i=l+n.key;o.push({Name:i,Tsize:Number(e.size),Hash:e.cid}),a+=e.size}else{let e=n.value;if(null==e.cid)continue;let t=l+n.key,r=e.size;o.push({Name:t,Tsize:Number(r),Hash:e.cid}),a+=BigInt(r??0)}}let l=Uint8Array.from(i.bitField().reverse()),u=new sr({type:"hamt-sharded-directory",data:l,fanout:BigInt(e.tableSize()),hashType:Or,mtime:n?.mtime,mode:n?.mode}),h=dt(at({Data:u.marshal(),Links:o})),c=await ar(h,t,r),f=BigInt(h.byteLength)+a;yield{cid:c,unixfs:u,size:f}}function Vr(e){return"function"==typeof e.flush}function Hr(e,t,n){let r=e._children,i=(e.tableSize()-1).toString(16).length,s=[];for(let e=0;e<r.length;e++){let t=r.get(e);if(null==t)continue;let o=e.toString(16).toUpperCase().padStart(i,"0");if(t instanceof Br){let e=Hr(t,null,n);s.push({Name:o,Tsize:Number(e),Hash:0===n.cidVersion?kr:_r})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();s.push({Name:o+t.key,Tsize:Number(e),Hash:0===n.cidVersion?kr:_r})}else{let e=t.value;if(null==e.cid)continue;let n=o+t.key,r=e.size;s.push({Name:n,Tsize:Number(r),Hash:e.cid})}}let o=Uint8Array.from(r.bitField().reverse());return dt(at({Data:new sr({type:"hamt-sharded-directory",data:o,fanout:BigInt(e.tableSize()),hashType:Or,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:s})).length}async function Gr(e,t,n,r){let i=t;t instanceof xr&&t.estimateNodeSize()>n&&(i=await async function(e,t){let n=new Mr({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(let{key:t,child:r}of e.eachChildSeries())await n.put(t,r);return n}(t,r));let s=i.parent;if(null!=s){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return Gr(i,s,n,r)}return i}var Wr=(e="")=>e.split(/(?<!\\)\//).filter(Boolean);async function qr(e,t,n){let r=Wr(e.path??""),i=r.length-1,s=t,o="";for(let a=0;a<r.length;a++){let l=r[a];o+=`${""!==o?"/":""}${l}`;let u=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,u)await s.put(l,e),t=await Gr(null,s,n.shardSplitThresholdBytes,n);else{let e=await s.get(l);(null==e||!(e instanceof vr))&&(e=new xr({root:!1,dir:!0,parent:s,parentKey:l,path:o,dirty:!0,flat:!0,mtime:e?.unixfs?.mtime,mode:e?.unixfs?.mode},n)),await s.put(l,e),s=e}}return t}async function*Xr(e,t){e instanceof vr?yield*e.flush(t):!0===e.unixfs?.isDirectory()&&(yield e)}async function*Kr(e,t,n={}){let r;r=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];let i=n.wrapWithDirectory??!1,s=n.shardSplitThresholdBytes??262144,o=n.shardFanoutBits??8,a=n.cidVersion??1,l=n.rawLeaves??!0,u=n.leafType??"file",h=n.fileImportConcurrency??50,c=n.blockWriteConcurrency??10,f=n.reduceSingleLeafToSelf??!0,d=n.chunker??D(),p=n.chunkValidator??wr(),y=n.dagBuilder??function(e){return async function*(t,n){for await(let r of t){let t;if(null!=r.path&&(t=r.path,r.path=r.path.split("/").filter((e=>null!=e&&"."!==e)).join("/")),pr(r)){let i={path:r.path,mtime:r.mtime,mode:r.mode,content:async function*(){let t=0n;for await(let n of e.chunker(e.chunkValidator(dr(r.content)))){let i=BigInt(n.byteLength);t+=i,e.onProgress?.(new or("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:i,path:r.path})),yield n}}(),originalPath:t};yield async()=>fr(i,n,e)}else{if(null==r.path)throw new Error("Import candidate must have content or path or both");{let i={path:r.path,mtime:r.mtime,mode:r.mode,originalPath:t};yield async()=>hr(i,n,e)}}}}}({chunker:d,chunkValidator:p,wrapWithDirectory:i,layout:n.layout??mr(),bufferImporter:n.bufferImporter??lr({cidVersion:a,rawLeaves:l,leafType:u,onProgress:n.onProgress}),blockWriteConcurrency:c,reduceSingleLeafToSelf:f,cidVersion:a,onProgress:n.onProgress}),w=n.treeBuilder??function(e){return async function*(t,n){let r,i=new xr({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),s=!1;for await(let n of t){if(null==n)continue;let t=`${n.originalPath??""}`.split("/")[0];null!=t&&""!==t&&(null==r?(r=t,s=!0):r!==t&&(s=!1)),i=await qr(n,i,e),(null==n.unixfs||!n.unixfs.isDirectory())&&(yield n)}if(e.wrapWithDirectory||s&&i.childCount()>1)yield*Xr(i,n);else for await(let e of i.eachChildSeries())null!=e&&(yield*Xr(e.child,n))}}({wrapWithDirectory:i,shardSplitThresholdBytes:s,shardFanoutBits:o,cidVersion:a,onProgress:n.onProgress});for await(let e of w(E(y(r,t),h),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}async function Jr(e,t,n={}){let r=await _(Kr([e],t,n));if(null==r)throw(0,k.default)(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return r}var Yr={cidVersion:1,rawLeaves:!0,layout:mr({maxChildrenPerNode:1024}),chunker:D({chunkSize:1048576})};var Qr=u(h(),1),Zr=function(e){if(function(e){return null!=e[Symbol.asyncIterator]}(e))return(async()=>{let t;for await(let n of e)t=n;return t})();let t;for(let n of e)t=n;return t},ei=["string","number","bigint","symbol"],ti=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];var ni=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};ni.uint=new ni(0,"uint",!0),ni.negint=new ni(1,"negint",!0),ni.bytes=new ni(2,"bytes",!0),ni.string=new ni(3,"string",!0),ni.array=new ni(4,"array",!1),ni.map=new ni(5,"map",!1),ni.tag=new ni(6,"tag",!1),ni.float=new ni(7,"float",!0),ni.false=new ni(7,"false",!0),ni.true=new ni(7,"true",!0),ni.null=new ni(7,"null",!0),ni.undefined=new ni(7,"undefined",!0),ni.break=new ni(7,"break",!0);var ri=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}},ii=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,si=new TextDecoder,oi=new TextEncoder;function ai(e){return ii&&globalThis.Buffer.isBuffer(e)}var li=ii?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):pi(e,t,n):(e,t,n)=>n-t>64?si.decode(e.subarray(t,n)):pi(e,t,n),ui=ii?e=>e.length>64?globalThis.Buffer.from(e):di(e):e=>e.length>64?oi.encode(e):di(e),hi=ii?(e,t,n)=>ai(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),ci=ii?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),function(e){return e instanceof Uint8Array?ai(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}(globalThis.Buffer.concat(e,t))):(e,t)=>{let n=new Uint8Array(t),r=0;for(let t of e)r+t.length>n.length&&(t=t.subarray(0,n.length-r)),n.set(t,r),r+=t.length;return n},fi=ii?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function di(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function pi(e,t,n){let r=[];for(;t<n;){let i=e[t],s=null,o=i>239?4:i>223?3:i>191?2:1;if(t+o<=n){let n,r,a,l;switch(o){case 1:i<128&&(s=i);break;case 2:n=e[t+1],128==(192&n)&&(l=(31&i)<<6|63&n,l>127&&(s=l));break;case 3:n=e[t+1],r=e[t+2],128==(192&n)&&128==(192&r)&&(l=(15&i)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(l=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),t+=o}return wi(r)}var yi=4096;function wi(e){let t=e.length;if(t<=yi)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=yi));return n}var gi="CBOR decode error:",mi="CBOR encode error:",bi=[];function vi(e,t,n){if(e.length-t<n)throw new Error(`${gi} not enough data for type`)}bi[23]=1,bi[24]=2,bi[25]=3,bi[26]=5,bi[27]=9;var ki=[24,256,65536,4294967296,BigInt("18446744073709551616")];function _i(e,t,n){vi(e,t,1);let r=e[t];if(!0===n.strict&&r<ki[0])throw new Error(`${gi} integer encoded in more bytes than necessary (strict decode)`);return r}function xi(e,t,n){vi(e,t,2);let r=e[t]<<8|e[t+1];if(!0===n.strict&&r<ki[1])throw new Error(`${gi} integer encoded in more bytes than necessary (strict decode)`);return r}function Ei(e,t,n){vi(e,t,4);let r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<ki[2])throw new Error(`${gi} integer encoded in more bytes than necessary (strict decode)`);return r}function Si(e,t,n){vi(e,t,8);let r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],s=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&s<ki[3])throw new Error(`${gi} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===n.allowBigInt)return s;throw new Error(`${gi} integers outside of the safe integer range are not supported`)}function Ni(e,t){return Bi(e,0,t.value)}function Bi(e,t,n){if(n<ki[0]){let r=Number(n);e.push([t|r])}else if(n<ki[1]){let r=Number(n);e.push([24|t,r])}else if(n<ki[2]){let r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<ki[3]){let r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{let r=BigInt(n);if(!(r<ki[4]))throw new Error(`${gi} encountered BigInt larger than allowable range`);{let n=[27|t,0,0,0,0,0,0,0],i=Number(r&BigInt(4294967295)),s=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&s,s>>=8,n[3]=255&s,s>>=8,n[2]=255&s,s>>=8,n[1]=255&s,e.push(n)}}}Ni.encodedSize=function(e){return Bi.encodedSize(e.value)},Bi.encodedSize=function(e){return e<ki[0]?1:e<ki[1]?2:e<ki[2]?3:e<ki[3]?5:9},Ni.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};var Ci=BigInt(-1),Ii=BigInt(1);function Ai(e,t){let n=t.value,r="bigint"==typeof n?n*Ci-Ii:-1*n-1;Bi(e,t.type.majorEncoded,r)}function Ti(e,t,n,r){vi(e,t,n+r);let i=hi(e,t+n,t+n+r);return new ri(ni.bytes,i,n+r)}function zi(e,t,n,r){return Ti(e,t,1,n)}function Di(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===ni.string?ui(e.value):e.value),e.encodedBytes}function Li(e,t){let n=Di(t);Bi(e,t.type.majorEncoded,n.length),e.push(n)}function Pi(e,t,n,r,i){let s=n+r;vi(e,t,s);let o=new ri(ni.string,li(e,t+n,t+s),s);return!0===i.retainStringBytes&&(o.byteValue=hi(e,t+n,t+s)),o}function Ui(e,t,n,r){return Pi(e,t,1,n,r)}Ai.encodedSize=function(e){let t=e.value,n="bigint"==typeof t?t*Ci-Ii:-1*t-1;return n<ki[0]?1:n<ki[1]?2:n<ki[2]?3:n<ki[3]?5:9},Ai.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Li.encodedSize=function(e){let t=Di(e);return Bi.encodedSize(t.length)+t.length},Li.compareTokens=function(e,t){return function(e,t){return e.length<t.length?-1:e.length>t.length?1:function(e,t){if(ai(e)&&ai(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}(e,t)}(Di(e),Di(t))};var Fi=Li;function $i(e,t,n,r){return new ri(ni.array,r,n)}function Ri(e,t,n,r){return $i(0,0,1,n)}function Oi(e,t){Bi(e,ni.array.majorEncoded,t.value)}function Mi(e,t,n,r){return new ri(ni.map,r,n)}function ji(e,t,n,r){return Mi(0,0,1,n)}function Vi(e,t){Bi(e,ni.map.majorEncoded,t.value)}function Hi(e,t,n,r){return new ri(ni.tag,n,1)}function Gi(e,t){Bi(e,ni.tag.majorEncoded,t.value)}Oi.compareTokens=Ni.compareTokens,Oi.encodedSize=function(e){return Bi.encodedSize(e.value)},Vi.compareTokens=Ni.compareTokens,Vi.encodedSize=function(e){return Bi.encodedSize(e.value)},Gi.compareTokens=Ni.compareTokens,Gi.encodedSize=function(e){return Bi.encodedSize(e.value)};function Wi(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error(`${gi} NaN values are not supported`);if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${gi} Infinity values are not supported`)}return new ri(ni.float,e,t)}function qi(e,t,n){let r=t.value;if(!1===r)e.push([20|ni.float.majorEncoded]);else if(!0===r)e.push([21|ni.float.majorEncoded]);else if(null===r)e.push([22|ni.float.majorEncoded]);else if(void 0===r)e.push([23|ni.float.majorEncoded]);else{let t,i=!1;(!n||!0!==n.float64)&&(Yi(r),t=Qi(Ji,1),r===t||Number.isNaN(r)?(Ji[0]=249,e.push(Ji.slice(0,3)),i=!0):(Zi(r),t=es(Ji,1),r===t&&(Ji[0]=250,e.push(Ji.slice(0,5)),i=!0))),i||(function(e){Ki.setFloat64(0,e,!1)}(r),t=ts(Ji,1),Ji[0]=251,e.push(Ji.slice(0,9)))}}qi.encodedSize=function(e,t){let n=e.value;if(!1===n||!0===n||null==n)return 1;if(!t||!0!==t.float64){Yi(n);let e=Qi(Ji,1);if(n===e||Number.isNaN(n))return 3;if(Zi(n),e=es(Ji,1),n===e)return 5}return 9};var Xi=new ArrayBuffer(9),Ki=new DataView(Xi,1),Ji=new Uint8Array(Xi,0);function Yi(e){if(e===1/0)Ki.setUint16(0,31744,!1);else if(e===-1/0)Ki.setUint16(0,64512,!1);else if(Number.isNaN(e))Ki.setUint16(0,32256,!1);else{Ki.setFloat32(0,e);let t=Ki.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)Ki.setUint16(0,31744,!1);else if(0===n)Ki.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{let e=n-127;e<-24?Ki.setUint16(0,0):e<-14?Ki.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):Ki.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function Qi(e,t){if(e.length-t<2)throw new Error(`${gi} not enough data for float16`);let n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;let r,i=n>>10&31,s=1023&n;return r=0===i?s*2**-24:31!==i?(s+1024)*2**(i-25):0===s?1/0:NaN,32768&n?-r:r}function Zi(e){Ki.setFloat32(0,e,!1)}function es(e,t){if(e.length-t<4)throw new Error(`${gi} not enough data for float32`);let n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function ts(e,t){if(e.length-t<8)throw new Error(`${gi} not enough data for float64`);let n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function ns(e,t,n){throw new Error(`${gi} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function rs(e){return()=>{throw new Error(`${gi} ${e}`)}}qi.compareTokens=Ni.compareTokens;var is=[];for(let e=0;e<=23;e++)is[e]=ns;is[24]=function(e,t,n,r){return new ri(ni.uint,_i(e,t+1,r),2)},is[25]=function(e,t,n,r){return new ri(ni.uint,xi(e,t+1,r),3)},is[26]=function(e,t,n,r){return new ri(ni.uint,Ei(e,t+1,r),5)},is[27]=function(e,t,n,r){return new ri(ni.uint,Si(e,t+1,r),9)},is[28]=ns,is[29]=ns,is[30]=ns,is[31]=ns;for(let e=32;e<=55;e++)is[e]=ns;is[56]=function(e,t,n,r){return new ri(ni.negint,-1-_i(e,t+1,r),2)},is[57]=function(e,t,n,r){return new ri(ni.negint,-1-xi(e,t+1,r),3)},is[58]=function(e,t,n,r){return new ri(ni.negint,-1-Ei(e,t+1,r),5)},is[59]=function(e,t,n,r){let i=Si(e,t+1,r);if("bigint"!=typeof i){let e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ri(ni.negint,e,9)}if(!0!==r.allowBigInt)throw new Error(`${gi} integers outside of the safe integer range are not supported`);return new ri(ni.negint,Ci-BigInt(i),9)},is[60]=ns,is[61]=ns,is[62]=ns,is[63]=ns;for(let e=64;e<=87;e++)is[e]=zi;is[88]=function(e,t,n,r){return Ti(e,t,2,_i(e,t+1,r))},is[89]=function(e,t,n,r){return Ti(e,t,3,xi(e,t+1,r))},is[90]=function(e,t,n,r){return Ti(e,t,5,Ei(e,t+1,r))},is[91]=function(e,t,n,r){let i=Si(e,t+1,r);if("bigint"==typeof i)throw new Error(`${gi} 64-bit integer bytes lengths not supported`);return Ti(e,t,9,i)},is[92]=ns,is[93]=ns,is[94]=ns,is[95]=rs("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)is[e]=Ui;is[120]=function(e,t,n,r){return Pi(e,t,2,_i(e,t+1,r),r)},is[121]=function(e,t,n,r){return Pi(e,t,3,xi(e,t+1,r),r)},is[122]=function(e,t,n,r){return Pi(e,t,5,Ei(e,t+1,r),r)},is[123]=function(e,t,n,r){let i=Si(e,t+1,r);if("bigint"==typeof i)throw new Error(`${gi} 64-bit integer string lengths not supported`);return Pi(e,t,9,i,r)},is[124]=ns,is[125]=ns,is[126]=ns,is[127]=rs("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)is[e]=Ri;is[152]=function(e,t,n,r){return $i(0,0,2,_i(e,t+1,r))},is[153]=function(e,t,n,r){return $i(0,0,3,xi(e,t+1,r))},is[154]=function(e,t,n,r){return $i(0,0,5,Ei(e,t+1,r))},is[155]=function(e,t,n,r){let i=Si(e,t+1,r);if("bigint"==typeof i)throw new Error(`${gi} 64-bit integer array lengths not supported`);return $i(0,0,9,i)},is[156]=ns,is[157]=ns,is[158]=ns,is[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${gi} indefinite length items not allowed`);return $i(0,0,1,1/0)};for(let e=160;e<=183;e++)is[e]=ji;is[184]=function(e,t,n,r){return Mi(0,0,2,_i(e,t+1,r))},is[185]=function(e,t,n,r){return Mi(0,0,3,xi(e,t+1,r))},is[186]=function(e,t,n,r){return Mi(0,0,5,Ei(e,t+1,r))},is[187]=function(e,t,n,r){let i=Si(e,t+1,r);if("bigint"==typeof i)throw new Error(`${gi} 64-bit integer map lengths not supported`);return Mi(0,0,9,i)},is[188]=ns,is[189]=ns,is[190]=ns,is[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${gi} indefinite length items not allowed`);return Mi(0,0,1,1/0)};for(let e=192;e<=215;e++)is[e]=Hi;is[216]=function(e,t,n,r){return new ri(ni.tag,_i(e,t+1,r),2)},is[217]=function(e,t,n,r){return new ri(ni.tag,xi(e,t+1,r),3)},is[218]=function(e,t,n,r){return new ri(ni.tag,Ei(e,t+1,r),5)},is[219]=function(e,t,n,r){return new ri(ni.tag,Si(e,t+1,r),9)},is[220]=ns,is[221]=ns,is[222]=ns,is[223]=ns;for(let e=224;e<=243;e++)is[e]=rs("simple values are not supported");is[244]=ns,is[245]=ns,is[246]=ns,is[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw new Error(`${gi} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new ri(ni.null,null,1):new ri(ni.undefined,void 0,1)},is[248]=rs("simple values are not supported"),is[249]=function(e,t,n,r){return Wi(Qi(e,t+1),3,r)},is[250]=function(e,t,n,r){return Wi(es(e,t+1),5,r)},is[251]=function(e,t,n,r){return Wi(ts(e,t+1),9,r)},is[252]=ns,is[253]=ns,is[254]=ns,is[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${gi} indefinite length items not allowed`);return new ri(ni.break,void 0,1)};var ss=[];for(let e=0;e<24;e++)ss[e]=new ri(ni.uint,e,1);for(let e=-1;e>=-24;e--)ss[31-e]=new ri(ni.negint,e,1);ss[64]=new ri(ni.bytes,new Uint8Array(0),1),ss[96]=new ri(ni.string,"",1),ss[128]=new ri(ni.array,0,1),ss[160]=new ri(ni.map,0,1),ss[244]=new ri(ni.false,!1,1),ss[245]=new ri(ni.true,!0,1),ss[246]=new ri(ni.null,null,1),function(){let e=[];e[ni.uint.major]=Ni,e[ni.negint.major]=Ai,e[ni.bytes.major]=Li,e[ni.string.major]=Fi,e[ni.array.major]=Oi,e[ni.map.major]=Vi,e[ni.tag.major]=Gi,e[ni.float.major]=qi}(),new class{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){let e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=fi(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=hi(n,0,this.cursor)}else t=ci(this.chunks,this.cursor);return e&&this.reset(),t}};var os=class e{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(t,n){if(t&&t.includes(n))throw new Error(`${mi} object contains circular references`);return new e(n,t)}},as={null:new ri(ni.null,null),undefined:new ri(ni.undefined,void 0),true:new ri(ni.true,!0),false:new ri(ni.false,!1),emptyArray:new ri(ni.array,0),emptyMap:new ri(ni.map,0)},ls={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ri(e>=0?ni.uint:ni.negint,e):new ri(ni.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new ri(ni.uint,e):new ri(ni.negint,e),Uint8Array:(e,t,n,r)=>new ri(ni.bytes,e),string:(e,t,n,r)=>new ri(ni.string,e),boolean:(e,t,n,r)=>e?as.true:as.false,null:(e,t,n,r)=>as.null,undefined:(e,t,n,r)=>as.undefined,ArrayBuffer:(e,t,n,r)=>new ri(ni.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new ri(ni.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[as.emptyArray,new ri(ni.break)]:as.emptyArray;r=os.createCheck(r,e);let i=[],s=0;for(let t of e)i[s++]=us(t,n,r);return n.addBreakTokens?[new ri(ni.array,e.length),i,new ri(ni.break)]:[new ri(ni.array,e.length),i]},Object(e,t,n,r){let i="Object"!==t,s=i?e.keys():Object.keys(e),o=i?e.size:s.length;if(!o)return!0===n.addBreakTokens?[as.emptyMap,new ri(ni.break)]:as.emptyMap;r=os.createCheck(r,e);let a=[],l=0;for(let t of s)a[l++]=[us(t,n,r),us(i?e.get(t):e[t],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,n),n.addBreakTokens?[new ri(ni.map,o),a,new ri(ni.break)]:[new ri(ni.map,o),a]}};ls.Map=ls.Object,ls.Buffer=ls.Uint8Array;for(let e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ls[`${e}Array`]=ls.DataView;function us(e,t={},n){let r=function(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";let t=typeof e;if(ei.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";let n=function(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(ti.includes(t))return t}(e);return n||"Object"}(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||ls[r];if("function"==typeof i){let s=i(e,r,t,n);if(null!=s)return s}let s=ls[r];if(!s)throw new Error(`${mi} unsupported type: ${r}`);return s(e,r,t,n)}var hs={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},cs=class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],t=ss[e];if(void 0===t){let n=is[e];if(!n)throw new Error(`${gi} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let r=31&e;t=n(this.data,this._pos,r,this.options)}return this._pos+=t.encodedLength,t}},fs=Symbol.for("DONE"),ds=Symbol.for("BREAK");function ps(e,t){if(e.done())return fs;let n=e.next();if(n.type===ni.break)return ds;if(n.type.terminal)return n.value;if(n.type===ni.array)return function(e,t,n){let r=[];for(let i=0;i<e.value;i++){let s=ps(t,n);if(s===ds){if(e.value===1/0)break;throw new Error(`${gi} got unexpected break to lengthed array`)}if(s===fs)throw new Error(`${gi} found array but not enough entries (got ${i}, expected ${e.value})`);r[i]=s}return r}(n,e,t);if(n.type===ni.map)return function(e,t,n){let r=!0===n.useMaps,i=r?void 0:{},s=r?new Map:void 0;for(let o=0;o<e.value;o++){let a=ps(t,n);if(a===ds){if(e.value===1/0)break;throw new Error(`${gi} got unexpected break to lengthed map`)}if(a===fs)throw new Error(`${gi} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==r&&"string"!=typeof a)throw new Error(`${gi} non-string keys not supported (got ${typeof a})`);if(!0===n.rejectDuplicateMapKeys&&(r&&s.has(a)||!r&&a in i))throw new Error(`${gi} found repeat map key "${a}"`);let l=ps(t,n);if(l===fs)throw new Error(`${gi} found map but not enough entries (got ${o} [no value], expected ${e.value})`);r?s.set(a,l):i[a]=l}return r?s:i}(n,e,t);if(n.type===ni.tag){if(t.tags&&"function"==typeof t.tags[n.value]){let r=ps(e,t);return t.tags[n.value](r)}throw new Error(`${gi} tag not supported (${n.value})`)}throw new Error("unsupported")}function ys(e,t){let[n,r]=function(e,t){if(!(e instanceof Uint8Array))throw new Error(`${gi} data to decode must be a Uint8Array`);let n=(t=Object.assign({},hs,t)).tokenizer||new cs(e,t),r=ps(n,t);if(r===fs)throw new Error(`${gi} did not find any content to decode`);if(r===ds)throw new Error(`${gi} got unexpected break`);return[r,e.subarray(n.pos())]}(e,t);if(r.length>0)throw new Error(`${gi} too many terminals, data makes no sense`);return n}var ws={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ws.tags[42]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Fe.decode(e.subarray(1))},ws.tags.slice();var gs=113,ms=(ni.uint.major,ni.negint.major,ni.bytes.major,ni.string.major,ni.array.major,ni.map.major,ni.tag.major,ni.float.major,class{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${gi} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${gi} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,t=!1,n=!1,r=e=>{for(;!this.done();){let t=this.ch();if(!e.includes(t))break;this._pos++}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new ri(ni.uint,0,this._pos-e);this._pos++,n=!0}if(r([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${gi} unexpected token at position ${this._pos}`);if(!this.done()&&46===this.ch()){if(n)throw new Error(`${gi} unexpected token at position ${this._pos}`);n=!0,this._pos++,r([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(101===this.ch()||69===this.ch())&&(n=!0,this._pos++,!this.done()&&(43===this.ch()||45===this.ch())&&this._pos++,r([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),s=parseFloat(i);return n?new ri(ni.float,s,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new ri(s>=0?ni.uint:ni.negint,s,this._pos-e):new ri(s>=0?ni.uint:ni.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw new Error(`${gi} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let e=this._pos,t=0;e<this.data.length&&t<65536;e++,t++){let n=this.data[e];if(92===n||n<32||n>=128)break;if(34===n){let n=String.fromCharCode.apply(null,this.data.subarray(this._pos,e));return this._pos=e+1,new ri(ni.string,n,t)}}let e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${gi} unexpected end of unicode escape sequence at position ${this._pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${gi} unexpected unicode escape character at position ${this._pos}`);t=t-65+10}e=16*e+t,this._pos++}return e},r=()=>{let e,n,r,i,s=this.ch(),o=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${gi} unexpected unicode sequence at position ${this._pos}`);switch(a){case 1:s<128&&(o=s);break;case 2:e=this.data[this._pos+1],128==(192&e)&&(i=(31&s)<<6|63&e,i>127&&(o=i));break;case 3:e=this.data[this._pos+1],n=this.data[this._pos+2],128==(192&e)&&128==(192&n)&&(i=(15&s)<<12|(63&e)<<6|63&n,i>2047&&(i<55296||i>57343)&&(o=i));break;case 4:e=this.data[this._pos+1],n=this.data[this._pos+2],r=this.data[this._pos+3],128==(192&e)&&128==(192&n)&&128==(192&r)&&(i=(15&s)<<18|(63&e)<<12|(63&n)<<6|63&r,i>65535&&i<1114112&&(o=i))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this._pos+=a};for(;!this.done();){let i,s=this.ch();switch(s){case 92:if(this._pos++,this.done())throw new Error(`${gi} unexpected string termination at position ${this._pos}`);switch(i=this.ch(),this._pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${gi} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new ri(ni.string,wi(t),this._pos-e);default:if(s<32)throw new Error(`${gi} invalid control character at position ${this._pos}`);s<128?(t.push(s),this._pos++):r()}}throw new Error(`${gi} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new ri(ni.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new ri(ni.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ri(ni.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ri(ni.false,!1,5);case 116:return this.expect([116,114,117,101]),new ri(ni.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${gi} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new ri(ni.break,void 0,1);if(44!==this.ch())throw new Error(`${gi} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this._pos++,this.skipWhitespace(),new ri(ni.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new ri(ni.break,void 0,1);if(44!==this.ch())throw new Error(`${gi} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new ri(ni.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${gi} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${gi} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}),bs=class extends ms{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===ni.map){let e=this._next();if(e.type===ni.string&&"/"===e.value){let e=this._next();if(e.type===ni.string){if(this._next().type!==ni.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new ri(ni.tag,42,0)}if(e.type===ni.map){let e=this._next();if(e.type===ni.string&&"bytes"===e.value){let e=this._next();if(e.type===ni.string){for(let e=0;e<2;e++)if(this._next().type!==ni.break)throw new Error("Invalid encoded Bytes form");let t=on.decode(`m${e.value}`);return new ri(ni.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}},vs={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};vs.tags[42]=Fe.parse;var ks=297,_s=(new TextDecoder,new TextEncoder,u(h(),1)),xs=u(h(),1);function Es(e,t,n,r,i,s,o){let a=e,l=i;for(;s.length>0;){let u=s[0];if(!(u in a))throw(0,xs.default)(new Error(`No property named ${u} found in node ${n}`),"ERR_NO_PROP");{s.shift(),l=`${l}/${u}`;let h=Fe.asCID(a[u]);if(null!=h)return{entry:{type:"object",name:r,path:i,cid:n,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}},next:{cid:h,name:u,path:l,toResolve:s}};a=a[u]}}return{entry:{type:"object",name:r,path:i,cid:n,node:t,depth:o,size:BigInt(t.length),content:async function*(){yield e}}}}var Ss=u(h(),1),Ns=function(e,t,n,r){let i=BigInt(e.length),s=BigInt(t+i);return n>=s||r<t?new Uint8Array(0):(r>=t&&r<s&&(e=e.subarray(0,Number(r-t))),n>=t&&n<s&&(e=e.subarray(Number(n-t))),e)},Bs=u(h(),1),Cs=(e,t=0,n=e)=>{let r=BigInt(e),i=BigInt(t??0),s=BigInt(n);if(s!==r&&(s=i+s),s>r&&(s=r),i<0n)throw(0,Bs.default)(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>r)throw(0,Bs.default)(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(s<0n)throw(0,Bs.default)(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(s>r)throw(0,Bs.default)(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:s}},Is=e=>async function*(t={}){let{start:n,end:r}=Cs(e.length,t.offset,t.length),i=Ns(e,0n,n,r);t.onProgress?.(new or("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:r-n,fileSize:BigInt(e.byteLength)})),yield i},As=u(h(),1),Ts=e=>async function*(t={}){let{start:n,end:r}=Cs(e.length,t.offset,t.length),i=Ns(e,0n,n,r);t.onProgress?.(new or("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:r-n,fileSize:BigInt(e.byteLength)})),yield i},zs=u(h(),1),Ds=u(h(),1),Ls=async function(e){return(await Sr.encode(e)).slice(0,8).reverse()},Ps=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),Us=async(e,t,n,r,i)=>{if(null==r){if(null==e.Data)throw(0,Ds.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let t;try{t=sr.unmarshal(e.Data)}catch(e){throw(0,Ds.default)(e,"ERR_NOT_UNIXFS")}if("hamt-sharded-directory"!==t.type)throw(0,Ds.default)(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(null==t.fanout)throw(0,Ds.default)(new Error("missing fanout"),"ERR_NOT_UNIXFS");let n=$r({hashFn:Ls,bits:Math.log2(Number(t.fanout))});r={rootBucket:n,hamtDepth:1,lastBucket:n}}let s=(r.lastBucket.tableSize()-1).toString(16).length;await(async(e,t,n)=>{let r=(t.tableSize()-1).toString(16).length;await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(e.Name.length!==r)await n.put(e.Name.substring(2),!0);else{let r=parseInt(e.Name,16);t._putObjectAt(r,new Br({hash:n._options.hash,bits:n._options.bits},t,r))}})))})(e.Links,r.lastBucket,r.rootBucket);let o=await r.rootBucket._findNewBucketAndPos(t),a=Ps(o.pos,s),l=(e=>{let t=e.bucket,n=[];for(;null!=t._parent;)n.push(t),t=t._parent;return n.push(t),n.reverse()})(o);l.length>r.hamtDepth&&(r.lastBucket=l[r.hamtDepth],a=Ps(r.lastBucket._posAtParent,s));let u=e.Links.find((e=>{if(null==e.Name)return!1;let n=e.Name.substring(0,s),r=e.Name.substring(s);return!(n!==a||""!==r&&r!==t)}));if(null!=u)return null!=u.Name&&u.Name.substring(s)===t?u.Hash:(r.hamtDepth++,e=pt(await n.get(u.Hash,i)),Us(e,t,n,r,i))},Fs=Us,$s=function(e){let[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}},Rs=function(e,t){let n=0;if(function(e){return null!=e[Symbol.asyncIterator]}(e))return async function*(){for await(let r of e)yield t(r,n++)}();let r=$s(e),{value:i,done:s}=r.next();if(!0===s)return function*(){}();let o=t(i,n++);if("function"==typeof o.then)return async function*(){yield await o;for await(let e of r)yield t(e,n++)}();let a=t;return function*(){yield o;for(let e of r)yield a(e,n++)}()};function Os(){let e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}var Ms=globalThis.CustomEvent??Event;async function*js(e,t={}){let n=t.concurrency??1/0;n<1&&(n=1/0);let r,i=null!=t.ordered&&t.ordered,s=new EventTarget,o=[],a=Os(),l=Os(),u=!1,h=!1;function c(){return i?o[0]?.done:!!o.find((e=>e.done))}function*f(){for(;o.length>0&&o[0].done;){let e=o[0];if(o.shift(),!e.ok)throw h=!0,a.resolve(),e.err;yield e.value,a.resolve()}}function*d(){for(;c();)for(let e=0;e<o.length;e++)if(o[e].done){let t=o[e];if(o.splice(e,1),e--,!t.ok)throw h=!0,a.resolve(),t.err;yield t.value,a.resolve()}}for(s.addEventListener("task-complete",(()=>{l.resolve()})),Promise.resolve().then((async()=>{try{for await(let t of e){if(o.length===n&&(a=Os(),await a.promise),h)break;let e={done:!1};o.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new Ms("task-complete"))}),(t=>{e.done=!0,e.err=t,s.dispatchEvent(new Ms("task-complete"))}))}u=!0,s.dispatchEvent(new Ms("task-complete"))}catch(e){r=e,s.dispatchEvent(new Ms("task-complete"))}}));;){if(c()||(l=Os(),await l.promise),null!=r)throw r;if(i?yield*f():yield*d(),u&&0===o.length)break}}var Vs=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}},Hs=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Vs(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Vs(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}},Gs=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Ws(e={}){return function(e,t){let n,r,i,s=(t=t??{}).onEnd,o=new Hs,a=Os(),l=e=>null!=r?r(e):(o.push(e),n),u=e=>{if(i)return n;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:e})},h=e=>i?n:(i=!0,null!=e?(e=>(o=new Hs,null!=r?r({error:e}):(o.push({error:e}),n)))(e):l({done:!0}));if(n={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?i?{done:!0}:await new Promise(((t,i)=>{r=s=>{r=null,o.push(s);try{t(e(o))}catch(e){i(e)}return n}})):e(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=Os()}))}},return:()=>(o=new Hs,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return o.size},onEmpty:async e=>{let t,n,r=e?.signal;if(r?.throwIfAborted(),!o.isEmpty()){null!=r&&(t=new Promise(((e,t)=>{n=()=>{t(new Gs)},r.addEventListener("abort",n)})));try{await Promise.race([a.promise,t])}finally{null!=n&&null!=r&&r?.removeEventListener("abort",n)}}}},null==s)return n;let c=n;return n={[Symbol.asyncIterator](){return this},next:()=>c.next(),throw:e=>(c.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(c.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(c.end(e),null!=s&&(s(e),s=void 0),n),get readableLength(){return c.readableLength},onEmpty:e=>c.onEmpty(e)},n}((e=>{let t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),e)}function qs(e){return null!=e[Symbol.asyncIterator]}function Xs(e,...t){if(null==e)throw new Error("Empty pipeline");if(Qs(e)){let t=e;e=()=>t.source}else if(Ys(e)||Js(e)){let t=e;e=()=>t}let n=[e,...t];if(n.length>1&&Qs(n[n.length-1])&&(n[n.length-1]=n[n.length-1].sink),n.length>2)for(let e=1;e<n.length-1;e++)Qs(n[e])&&(n[e]=Zs(n[e]));return Ks(...n)}var Ks=(...e)=>{let t;for(;e.length>0;)t=e.shift()(t);return t},Js=e=>null!=e?.[Symbol.asyncIterator],Ys=e=>null!=e?.[Symbol.iterator],Qs=e=>null!=e&&null!=e.sink&&null!=e.source,Zs=e=>t=>{let n=e.sink(t);if(null!=n?.then){let t=Ws({objectMode:!0});n.then((()=>{t.end()}),(e=>{t.end(e)}));let r,i=e.source;if(Js(i))r=async function*(){yield*i,t.end()};else{if(!Ys(i))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");r=function*(){yield*i,t.end()}}return function(...e){let t=[];for(let n of e)qs(n)||t.push(n);return t.length===e.length?function*(){for(let e of t)yield*e}():async function*(){let t=Ws({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(let n of e)t.push(n)}))),t.end()}catch(e){t.end(e)}})),yield*t}()}(t,r())}return e.source},eo=u(h(),1),to=u(p(),1),no=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},ro=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},io=e=>void 0===globalThis.DOMException?new ro(e):new DOMException(e),so=e=>{let t=void 0===e.reason?io("This operation was aborted."):e.reason;return t instanceof Error?t:io(t)},oo=class{#e=[];enqueue(e,t){let n={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&this.#e[this.size-1].priority>=t.priority)return void this.#e.push(n);let r=function(e,t,n){let r=0,i=e.length;for(;i>0;){let s=Math.trunc(i/2),o=r+s;n(e[o],t)<=0?(r=++o,i-=s+1):i=s}return r}(this.#e,n,((e,t)=>t.priority-e.priority));this.#e.splice(r,0,n)}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this.#e.length}},ao=class extends to.default{#e;#t;#n=0;#r;#i;#s=0;#o;#a;#l;#u;#h=0;#c;#f;#d;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:oo,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,this.#r=e.intervalCap,this.#i=e.interval,this.#l=new e.queueClass,this.#u=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#d=!0===e.throwOnTimeout,this.#f=!1===e.autoStart}get#p(){return this.#t||this.#n<this.#r}get#y(){return this.#h<this.#c}#w(){this.#h--,this.#g(),this.emit("next")}#m(){this.#b(),this.#v(),this.#a=void 0}get#k(){let e=Date.now();if(void 0===this.#o){let t=this.#s-e;if(!(t<0))return void 0===this.#a&&(this.#a=setTimeout((()=>{this.#m()}),t)),!0;this.#n=this.#e?this.#h:0}return!1}#g(){if(0===this.#l.size)return this.#o&&clearInterval(this.#o),this.#o=void 0,this.emit("empty"),0===this.#h&&this.emit("idle"),!1;if(!this.#f){let e=!this.#k;if(this.#p&&this.#y){let t=this.#l.dequeue();return!!t&&(this.emit("active"),t(),e&&this.#v(),!0)}}return!1}#v(){this.#t||void 0!==this.#o||(this.#o=setInterval((()=>{this.#b()}),this.#i),this.#s=Date.now()+this.#i)}#b(){0===this.#n&&0===this.#h&&this.#o&&(clearInterval(this.#o),this.#o=void 0),this.#n=this.#e?this.#h:0,this.#_()}#_(){for(;this.#g(););}get concurrency(){return this.#c}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#c=e,this.#_()}async#x(e){return new Promise(((t,n)=>{e.addEventListener("abort",(()=>{n(e.reason)}),{once:!0})}))}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:this.#d,...t},new Promise(((n,r)=>{this.#l.enqueue((async()=>{this.#h++,this.#n++;try{t.signal?.throwIfAborted();let r=e({signal:t.signal});t.timeout&&(r=function(e,t){let n,{milliseconds:r,fallback:i,message:s,customTimers:o={setTimeout,clearTimeout}}=t,a=new Promise(((a,l)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(t.signal){let{signal:e}=t;e.aborted&&l(so(e)),e.addEventListener("abort",(()=>{l(so(e))}))}if(r===Number.POSITIVE_INFINITY)return void e.then(a,l);let u=new no;n=o.setTimeout.call(void 0,(()=>{if(i)try{a(i())}catch(e){l(e)}else"function"==typeof e.cancel&&e.cancel(),!1===s?a():s instanceof Error?l(s):(u.message=s??`Promise timed out after ${r} milliseconds`,l(u))}),r),(async()=>{try{a(await e)}catch(e){l(e)}})()})).finally((()=>{a.clear()}));return a.clear=()=>{o.clearTimeout.call(void 0,n),n=void 0},a}(Promise.resolve(r),{milliseconds:t.timeout})),t.signal&&(r=Promise.race([r,this.#x(t.signal)]));let i=await r;n(i),this.emit("completed",i)}catch(e){if(e instanceof no&&!t.throwOnTimeout)return void n();r(e),this.emit("error",e)}finally{this.#w()}}),t),this.emit("add"),this.#g()}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this.#f?(this.#f=!1,this.#_(),this):this}pause(){this.#f=!0}clear(){this.#l=new this.#u}async onEmpty(){0!==this.#l.size&&await this.#E("empty")}async onSizeLessThan(e){this.#l.size<e||await this.#E("next",(()=>this.#l.size<e))}async onIdle(){0===this.#h&&0===this.#l.size||await this.#E("idle")}async#E(e,t){return new Promise((n=>{let r=()=>{t&&!t()||(this.off(e,r),n())};this.on(e,r)}))}get size(){return this.#l.size}sizeBy(e){return this.#l.filter(e).length}get pending(){return this.#h}get isPaused(){return this.#f}};async function lo(e,t,n,r,i,s,o){if(t instanceof Uint8Array){let e=Ns(t,r,i,s);return void n.push(e)}if(null==t.Data)throw(0,eo.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=sr.unmarshal(t.Data)}catch(e){throw(0,eo.default)(e,"ERR_NOT_UNIXFS")}if(null!=a.data){let e=a.data,t=Ns(e,r,i,s);n.push(t),r+=BigInt(t.byteLength)}let l=[];if(t.Links.length!==a.blockSizes.length)throw(0,eo.default)(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let e=0;e<t.Links.length;e++){let n=t.Links[e],o=r,u=o+a.blockSizes[e];if((i>=o&&i<u||s>=o&&s<=u||i<o&&s>u)&&l.push({link:n,blockStart:r}),(r=u)>s)break}await Xs(l,(t=>Rs(t,(t=>async()=>{let n=await e.get(t.link.Hash,o);return{...t,block:n}}))),(e=>js(e,{ordered:!0,concurrency:o.blockReadConcurrency})),(async t=>{for await(let{link:r,block:a,blockStart:l}of t){let t;switch(r.Hash.code){case ft:t=pt(a);break;case mn:t=a;break;default:return void n.end((0,eo.default)(new Error(`Unsupported codec: ${r.Hash.code}`),"ERR_NOT_UNIXFS"))}let u=new ao({concurrency:1});u.on("error",(e=>{n.end(e)})),u.add((async()=>{o.onProgress?.(new or("unixfs:exporter:walk:file",{cid:r.Hash})),await lo(e,t,n,l,i,s,o)})),await u.onIdle()}})),r>=s&&n.end()}var uo=(e,t,n,r,i,s,o)=>async function*(r={}){let i=n.fileSize();if(void 0===i)throw new Error("File was a directory");let{start:s,end:a}=Cs(i,r.offset,r.length);if(0n===a)return;let l=0n,u=a-s,h=Ws();r.onProgress?.(new or("unixfs:exporter:walk:file",{cid:e})),lo(o,t,h,0n,s,a,r).catch((e=>{h.end(e)}));for await(let e of h)if(null!=e){if(l+=BigInt(e.byteLength),l>u)throw h.end(),(0,eo.default)(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");l===u&&h.end(),r.onProgress?.(new or("unixfs:exporter:progress:unixfs:file",{bytesRead:l,totalBytes:u,fileSize:i})),yield e}if(l<u)throw(0,eo.default)(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")},ho=u(h(),1);async function*co(e,t,n,r,i,s){let o,a=e.Links;if(null==e.Data)throw(0,ho.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{o=sr.unmarshal(e.Data)}catch(e){throw(0,ho.default)(e,"ERR_NOT_UNIXFS")}if(null==o.fanout)throw(0,ho.default)(new Error("missing fanout"),"ERR_NOT_UNIXFS");let l=(o.fanout-1n).toString(16).length,u=Xs(a,(o=>Rs(o,(o=>async()=>{let a=null!=o.Name?o.Name.substring(l):null;if(null!=a&&""!==a){let e=await n(o.Hash,a,`${t}/${a}`,[],r+1,i,s);return{entries:null==e.entry?[]:[e.entry]}}{let a=await i.get(o.Hash,s);return e=pt(a),s.onProgress?.(new or("unixfs:exporter:walk:hamt-sharded-directory",{cid:o.Hash})),{entries:co(e,t,n,r,i,s)}}}))),(e=>js(e,{ordered:!0,concurrency:s.blockReadConcurrency})));for await(let{entries:e}of u)yield*e}var fo={raw:uo,file:uo,directory:(e,t,n,r,i,s,o)=>async function*(n={}){let a=n.offset??0,l=n.length??t.Links.length,u=t.Links.slice(a,l);n.onProgress?.(new or("unixfs:exporter:walk:directory",{cid:e})),yield*Xs(u,(e=>Rs(e,(e=>async()=>{let t=e.Name??"",a=`${r}/${t}`;return(await i(e.Hash,t,a,[],s+1,o,n)).entry}))),(e=>js(e,{ordered:!0,concurrency:n.blockReadConcurrency})),(e=>function(e,t){let n=0;if(function(e){return null!=e[Symbol.asyncIterator]}(e))return async function*(){for await(let r of e)await t(r,n++)&&(yield r)}();let r=$s(e),{value:i,done:s}=r.next();if(!0===s)return function*(){}();let o=t(i,n++);if("function"==typeof o.then)return async function*(){await o&&(yield i);for await(let e of r)await t(e,n++)&&(yield e)}();let a=t;return function*(){!0===o&&(yield i);for(let e of r)a(e,n++)&&(yield e)}()}(e,(e=>null!=e))))},"hamt-sharded-directory":(e,t,n,r,i,s,o)=>function(n={}){return n.onProgress?.(new or("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),co(t,r,i,s,o,n)},metadata:(e,t,n,r,i,s,o)=>()=>[],symlink:(e,t,n,r,i,s,o)=>()=>[]},po={[ft]:async(e,t,n,r,i,s,o,a)=>{let l,u,h=pt(await o.get(e,a));if(null==t&&(t=e.toString()),null==h.Data)throw(0,zs.default)(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{l=sr.unmarshal(h.Data)}catch(e){throw(0,zs.default)(e,"ERR_NOT_UNIXFS")}if(null==n&&(n=t),r.length>0){let e;if(e="hamt-sharded-directory"===l?.type?await Fs(h,r[0],o):((e,t)=>e.Links.find((e=>e.Name===t))?.Hash)(h,r[0]),null==e)throw(0,zs.default)(new Error("file does not exist"),"ERR_NOT_FOUND");let t=r.shift();u={cid:e,toResolve:r,name:t??"",path:`${n}/${t}`}}let c=fo[l.type](e,h,l,n,i,s,o);if(null==c)throw(0,zs.default)(new Error("could not find content exporter"),"ERR_NOT_FOUND");return l.isDirectory()?{entry:{type:"directory",name:t,path:n,cid:e,content:c,unixfs:l,depth:s,node:h,size:l.fileSize()},next:u}:{entry:{type:"file",name:t,path:n,cid:e,content:c,unixfs:l,depth:s,node:h,size:l.fileSize()},next:u}},[mn]:async(e,t,n,r,i,s,o,a)=>{if(r.length>0)throw(0,As.default)(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");let l=await o.get(e,a);return{entry:{type:"raw",name:t,path:n,cid:e,content:Ts(l),depth:s,size:BigInt(l.length),node:l}}},[gs]:async(e,t,n,r,i,s,o,a)=>{let l=await o.get(e,a);return Es((e=>ys(function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e),ws))(l),l,e,t,n,r,s)},[ks]:async(e,t,n,r,i,s,o,a)=>{let l=await o.get(e,a);return Es((e=>{let t=function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e);return function(e,t){return ys(e,t=Object.assign({tokenizer:new ms(e,t)},t))}(t,Object.assign(vs,{tokenizer:new bs(t,vs)}))})(l),l,e,t,n,r,s)},[_n.code]:async(e,t,n,r,i,s,o,a)=>{if(r.length>0)throw(0,Ss.default)(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");let l=ze(e.multihash.bytes);return{entry:{type:"identity",name:t,path:n,cid:e,content:Is(l.digest),depth:s,size:BigInt(l.digest.length),node:l.digest}}},[yn]:async(e,t,n,r,i,s,o,a)=>{let l=await o.get(e,a),u=function(e){return JSON.parse(pn.decode(e))}(l);return Es(u,l,e,t,n,r,s)}},yo=async(e,t,n,r,i,s,o)=>{let a=po[e.code];if(null==a)throw(0,_s.default)(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return a(e,t,n,r,yo,i,s,o)},wo=yo,go=e=>{if(e instanceof Uint8Array)return{cid:Fe.decode(e),toResolve:[]};let t=Fe.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"==typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));let t=((e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean))(e);return{cid:Fe.parse(t[0]),toResolve:t.slice(1)}}throw(0,Qr.default)(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*mo(e,t,n={}){let{cid:r,toResolve:i}=go(e),s=r.toString(),o=s,a=i.length;for(;;){let l=await wo(r,s,o,i,a,t,n);if(null==l.entry&&null==l.next)throw(0,Qr.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(null!=l.entry&&(yield l.entry),null==l.next)return;i=l.next.toResolve,r=l.next.cid,s=l.next.name,o=l.next.path}}async function bo(e,t,n={}){let r=await Zr(mo(e,t,n));if(null==r)throw(0,Qr.default)(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return r}async function*vo(e,t,n={}){let r=await bo(e,t,n);if(null!=r&&(yield r,"directory"===r.type))for await(let e of async function*e(t,n){for await(let r of t.content(n))yield r,!(r instanceof Uint8Array)&&"directory"===r.type&&(yield*e(r,n))}(r,n))yield e}var ko=u(w(),1).default,_o=class extends Error{name;code;constructor(e,t,n){super(e),this.name=t,this.code=n}},xo=class extends _o{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}},Eo=class extends _o{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PBNODE")}},So=class extends _o{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}},No=class extends _o{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}},Bo=class extends _o{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}},Co=class extends _o{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}},Io=class extends _o{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}},Ao=class extends _o{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}},To=class extends _o{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}},zo=u(b(),1);function Do(e){let t=function(e){let t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}(`${e}:trace`);return zo.default.enabled(`${e}:trace`)&&null!=zo.default.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=(0,zo.default)(`${e}:trace`)),Object.assign((0,zo.default)(e),{error:(0,zo.default)(`${e}:error`),trace:t})}zo.default.formatters.b=e=>null==e?"undefined":he.baseEncode(e),zo.default.formatters.t=e=>null==e?"undefined":ee.baseEncode(e),zo.default.formatters.m=e=>null==e?"undefined":on.baseEncode(e),zo.default.formatters.p=e=>null==e?"undefined":e.toString(),zo.default.formatters.c=e=>null==e?"undefined":e.toString(),zo.default.formatters.k=e=>null==e?"undefined":e.toString(),zo.default.formatters.a=e=>null==e?"undefined":e.toString();var Lo=u(d(),1);function Po(e){return function(t){return t instanceof Uo?t:new Uo(t,e)}}var Uo=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){let e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t);n=(n<<r)+e.take(r),t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){let e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let e=this._depth>0?B([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Ro(t);this._buffers.push(n),this._availableBits+=n.availableBits()}},Fo=[255,254,252,248,240,224,192,128],$o=[1,3,7,15,31,63,127,255],Ro=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){let e=this._value[this._currentBytePos],r=this._currentBitPos+1,i=Math.min(r,t);n=(n<<i)+Oo(e,r-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function Oo(e,t,n){let r=function(e,t){return Fo[e]&$o[Math.min(t+e-1,7)]}(t,n);return(e&r)>>>t}var Mo=BigInt(Sr.code);async function jo(e){return(await Sr.encode(e)).subarray(0,8).reverse()}var Vo=u(d(),1),Ho=async(e,t,n)=>{null==n.codec&&(n.codec=L);let r=await Nn.digest(e),i=Fe.create(n.cidVersion,n.codec.code,r);return await t.put(i,e,{...n,signal:n.signal}),i},Go=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}},Wo=class extends Go{_bucket;constructor(e,t){super(e,t),this._bucket=$r({hashFn:jo,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(let{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=Ko(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(let t of qo(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*qo(e,t,n,r){let i=e._children,s=[],o=0n;for(let e=0;e<i.length;e++){let n=i.get(e);if(null==n)continue;let a=e.toString(16).toUpperCase().padStart(2,"0");if(n instanceof Br){let e;for await(let i of qo(n,t,null,r))e=i;if(null==e)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:a,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else if(Xo(n.value)){let e,r=n.value;for await(let n of r.flush(t))e=n,yield e;if(null==e)throw new Error("Did not flush dir");let i=a+n.key;s.push({Name:i,Tsize:Number(e.size),Hash:e.cid}),o+=e.size}else{let e=n.value;if(null==e.cid)continue;let t=a+n.key,r=e.size;s.push({Name:t,Tsize:Number(r),Hash:e.cid}),o+=BigInt(r??0)}}let a=Uint8Array.from(i.bitField().reverse()),l=new sr({type:"hamt-sharded-directory",data:a,fanout:BigInt(e.tableSize()),hashType:Mo,mtime:n?.mtime,mode:n?.mode}),u=dt(at({Data:l.marshal(),Links:s})),h=await Ho(u,t,r),c=BigInt(u.byteLength)+o;yield{cid:h,unixfs:l,size:c}}function Xo(e){return"function"==typeof e.flush}function Ko(e,t,n){let r=e._children,i=[];for(let e=0;e<r.length;e++){let t=r.get(e);if(null==t)continue;let s=e.toString(16).toUpperCase().padStart(2,"0");if(t instanceof Br){let e=Ko(t,null,n);i.push({Name:s,Tsize:Number(e),Hash:0===n.cidVersion?Jo:Yo})}else if("function"==typeof t.value.flush){let e=t.value.nodeSize();i.push({Name:s+t.key,Tsize:Number(e),Hash:0===n.cidVersion?Jo:Yo})}else{let e=t.value;if(null==e.cid)continue;let n=s+t.key,r=e.size;i.push({Name:n,Tsize:Number(r),Hash:e.cid})}}let s=Uint8Array.from(r.bitField().reverse());return dt(at({Data:new sr({type:"hamt-sharded-directory",data:s,fanout:BigInt(e.tableSize()),hashType:Mo,mtime:t?.mtime,mode:t?.mode}).marshal(),Links:i})).length}var Jo=Fe.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Yo=Fe.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),Qo=Do("helia:unixfs:commands:utils:hamt-utils"),Zo=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),ea=async(e,t,n)=>{let r,i,s=sr.unmarshal(e[0].node.Data??new Uint8Array(0)),o=BigInt(Math.pow(2,8));e.reverse();for(let a=0;a<e.length;a++){let l=a===e.length-1,u=e[a],h=Uint8Array.from(u.children.bitField().reverse()),c=new sr({type:"hamt-sharded-directory",data:h,fanout:o,hashType:Mo});l&&(c.mtime=s.mtime,c.mode=s.mode),i={Data:c.marshal(),Links:u.node.Links};let f=dt(at(i));if(r=await Ho(f,t,n),!l){let t=e[a+1];if(null==t)throw new Error("Was not operating on shard root but also had no parent?");Qo("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter((e=>e.Name!==t.prefix)),t.node.Links.push({Name:t.prefix,Hash:r,Tsize:u.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),f.byteLength)})}}if(null==r||null==i)throw new Error("Noting persisted");return{cid:r,node:i}},ta=async(e,t,n,r)=>{let i=Po(jo)(Dn(t)),s=[];for(;;){let o,a=pt(await n.get(e,r)),l=new Vo.default,u=await i.take(8),h=Zo(u);s.push({prefix:h,children:l,node:a});for(let e of a.Links){let t=e.Name??"";if(t.length<2)throw new Error("Invalid HAMT - link name was too short");let n=parseInt(t.substring(0,2),16);l.set(n,!0),t.startsWith(h)&&(o=e)}if(null==o){Qo("no link found with prefix %s for %s",h,t);break}let c=o.Name??"";if(c.length<2)throw new Error("Invalid HAMT - link name was too short");if(2!==c.length)break;e=o.Hash,Qo("descend into sub-shard with prefix %s",c)}return{path:s,hash:i}};async function na(e,t,n,r){if(null==e.Data)throw new Error("DagPB node had no data");let i,s=sr.unmarshal(e.Data);if("directory"===s.type)i=function(e){let t=0;for(let n of e.Links)t+=(n.Name??"").length,t+=1===n.Hash.version?Yo.bytes.byteLength:Jo.bytes.byteLength;return t}(e);else{if("hamt-sharded-directory"!==s.type)throw new Error("Can only estimate the size of directories or shards");i=await ra(e,0,n,t,r)}return i>n}async function ra(e,t,n,r,i){if(t>n)return n;if(null==e.Data||!sr.unmarshal(e.Data).isDirectory())return t;for(let s of e.Links){let e=s.Name??"";if(e=e.substring(2),t+=e.length,t+=s.Hash.bytes.byteLength,s.Hash.code===ft){let e=pt(await r.get(s.Hash,i));t+=await ra(e,t,n,r,i)}}return t}var ia=Do("helia:unixfs:components:utils:add-link");async function sa(e,t,n,r){if(null==e.node.Data)throw new To("Invalid parent passed to addLink");if("hamt-sharded-directory"===sr.unmarshal(e.node.Data).type)return ia("adding link to sharded directory"),la(e,t,n,r);ia(`adding ${t.Name} (${t.Hash}) to regular directory`);let i=await aa(e,t,n,r);if(await na(i.node,n,r.shardSplitThresholdBytes,r)){ia("converting directory to sharded directory");let e=await oa(i,n);i.cid=e.cid,i.node=pt(await n.get(e.cid,r))}return i}var oa=async(e,t)=>{if(null==e.node.Data)throw new To("Invalid parent passed to convertToShardedDirectory");let n=sr.unmarshal(e.node.Data),r=await(async(e,t,n)=>{let r=new Wo({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:n.mtime,mode:n.mode},n);for(let e=0;e<t.length;e++)await r._bucket.put(t[e].name,{size:t[e].size,cid:t[e].cid});let i=await Zr(r.flush(e));if(null==i)throw new Error("Flushing shard yielded no result");return i})(t,e.node.Links.map((e=>({name:e.Name??"",size:BigInt(e.Tsize??0),cid:e.Hash}))),{mode:n.mode,mtime:n.mtime,cidVersion:e.cid.version});return ia(`converted directory to sharded directory ${r.cid}`),r},aa=async(e,t,n,r)=>{let i=e.node.Links.filter((e=>{let n=e.Name===t.Name;if(n&&!r.allowOverwriting)throw new No;return!n}));if(i.push(t),null==e.node.Data)throw new Eo("Parent node with no data passed to addToDirectory");let s,o=sr.unmarshal(e.node.Data);if(null!=o.mtime){let e=Date.now(),t=Math.floor(e/1e3);o.mtime={secs:BigInt(t),nsecs:1e3*(e-1e3*t)},s=o.marshal()}else s=e.node.Data;e.node=at({Data:s,Links:i});let a=dt(e.node),l=await Nn.digest(a),u=Fe.create(e.cid.version,ft,l);return await n.put(u,a),{node:e.node,cid:u}},la=async(e,t,n,r)=>{let{path:i,hash:s}=await ta(e.cid,t.Name,n,r),o=i[i.length-1];if(null==o)throw new Error("Invalid HAMT, could not generate path");let a=o.prefix,l=parseInt(a,16);ia("next prefix for %s is %s",t.Name,a);let u=`${a}${t.Name}`,h=o.node.Links.find((e=>(e.Name??"").startsWith(a)));if(null!=h)if(ia("link %s was present in shard",u),h.Name===u){if(!r.allowOverwriting)throw new No;ia("overwriting %s in subshard",t.Name),o.node.Links=o.node.Links.filter((e=>e.Name!==u)),o.node.Links.push({Name:u,Hash:t.Hash,Tsize:t.Tsize})}else{if(2===h.Name?.length)throw new Error("Existing link was subshard?!");{ia("prefix %s already exists, creating new subshard",a);let e=o.node.Links.findIndex((e=>e.Name?.startsWith(a))),n=o.node.Links.splice(e,1)[0],r=(n.Name??"").substring(2),l=Po(jo)(Dn(r));for(let e=0;e<i.length;e++)await l.take(8);for(;;){let e=await l.take(8),o=Zo(e);n.Name=`${o}${r}`;let u=await s.take(8),h=Zo(u);if(o===h){let e=new Lo.default;e.set(u,!0),i.push({prefix:h,children:e,node:{Links:[]}});continue}let c=new Lo.default;c.set(u,!0),c.set(e,!0),i.push({prefix:a,children:c,node:{Links:[n,{Name:`${h}${t.Name}`,Hash:t.Hash,Tsize:t.Tsize}]}});break}}}else ia("link %s was not present in sub-shard",u),t.Name=u,o.node.Links.push(t),o.children.set(l,!0),ia("adding %s to existing sub-shard",u);return ea(i,n,r)};async function ua(e,t,n={}){let r=await bo(e,t,n);if("directory"!==r.type)throw new Ao(`${e.toString()} was not a UnixFS directory`);return{cid:e,node:r.node}}async function ha(e,t,n,r){let i=await bo(e,n,r);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new xo(`${e.toString()} was not a UnixFS node`);return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:ca(i.node),Hash:e}}function ca(e){let t=e.Links.reduce(((e,t)=>e+(t.Tsize??0)),0);return dt(e).byteLength+t}var fa=Do("helia:unixfs:components:utils:resolve");async function da(e,t,n,r){if(null==t||""===t)return{cid:e};let i=`/ipfs/${e}${null==t?"":`/${t}`}`,s=await br(mo(i,n,r));if(0===s.length)throw new Bo("Could not find path in directory");return fa("resolved %s to %c",t,e),{cid:s[s.length-1].cid,path:t,segments:s}}async function pa(e,t,n,r){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw new Error("Insufficient segments");i.cid=e,t.segments.reverse();for(let s of t.segments){let[t,o]=await Promise.all([ua(s.cid,n,r),ha(i.cid,i.name,n,r)]);e=(await sa(t,o,n,{...r,allowOverwriting:!0,cidVersion:e.version})).cid,s.cid=e,i=s}return e}var ya=ko.bind({ignoreUndefined:!0}),wa={},ga=ko.bind({ignoreUndefined:!0}),ma=Do("helia:unixfs:chmod"),ba={recursive:!1,shardSplitThresholdBytes:262144},va=ko.bind({ignoreUndefined:!0}),ka=Do("helia:unixfs:cp"),_a={force:!1,shardSplitThresholdBytes:262144},xa=ko.bind({ignoreUndefined:!0}),Ea={},Sa=ko.bind({ignoreUndefined:!0}),Na=Do("helia:unixfs:mkdir"),Ba={cidVersion:1,force:!1,shardSplitThresholdBytes:262144},Ca=Do("helia:unixfs:utils:remove-link"),Ia=ko.bind({ignoreUndefined:!0}),Aa=Do("helia:unixfs:rm"),Ta={shardSplitThresholdBytes:262144};async function za(e,t,n,r={}){let i=Ia(Ta,r);if(t.includes("/"))throw new To("Name must not have slashes");let s=await ua(e,n,i);return Aa("Removing %s from %c",t,e),(await async function(e,t,n,r){if(null==e.node.Data)throw new Eo("Parent node had no data");if("hamt-sharded-directory"===sr.unmarshal(e.node.Data).type){Ca(`removing ${t} from sharded directory`);let i=await(async(e,t,n,r)=>{let{path:i}=await ta(e.cid,t,n,r),s=i[i.length-1];if(null==s)throw new Error("Invalid HAMT, could not generate path");let o=s.node.Links.filter((e=>(e.Name??"").substring(2)===t)).map((e=>e.Name)).pop();if(null==o)throw new Error("File not found");let a=o.substring(0,2),l=parseInt(a,16);if(s.node.Links=s.node.Links.filter((e=>e.Name!==o)),s.children.unset(l),1===s.node.Links.length)for(;1!==i.length;){let e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();let t=i[i.length-1];if(null==t)break;let n=e.node.Links[0];t.node.Links=t.node.Links.filter((e=>!(e.Name??"").startsWith(t.prefix))),t.node.Links.push({Hash:n.Hash,Name:`${t.prefix}${(n.Name??"").substring(2)}`,Tsize:n.Tsize})}return ea(i,n,r)})(e,t,n,r);return await na(i.node,n,r.shardSplitThresholdBytes,r)?i:(Ca("converting shard to flat directory %c",e.cid),(async(e,t,n)=>{if(null==e.node.Data)throw new To("Invalid parent passed to convertToFlatDirectory");let r={Links:[]},i=await bo(e.cid,t);if("directory"!==i.type)throw new Error("Unexpected node type");for await(let e of i.content()){let t=0;t=e.node instanceof Uint8Array?e.node.byteLength:dt(e.node).length,r.Links.push({Hash:e.cid,Name:e.name,Tsize:t})}let s=sr.unmarshal(e.node.Data);r.Data=new sr({type:"directory",mode:s.mode,mtime:s.mtime}).marshal();let o=dt(at(r));return{cid:await Ho(o,t,{codec:L,cidVersion:e.cid.version,signal:n.signal}),node:r}})(i,n,r))}return Ca(`removing link ${t} regular directory`),(async(e,t,n,r)=>{e.node.Links=e.node.Links.filter((e=>e.Name!==t));let i=dt(e.node),s=await Ho(i,n,{...r,cidVersion:e.cid.version});return Ca(`Updated regular directory ${s}`),{node:e.node,cid:s}})(e,t,n,r)}(s,t,n,{...i,cidVersion:e.version})).cid}var Da=ko.bind({ignoreUndefined:!0}),La=Do("helia:unixfs:stat"),Pa={};async function Ua(e,t,n={}){let r=Da(Pa,n),i=await da(e,n.path,t,r);La("stat %c",i.cid);let s=await bo(i.cid,t,r);if("file"!==s.type&&"directory"!==s.type&&"raw"!==s.type)throw new xo;let o,a,l,u=0n,h=0n,c=0n,f=0n,d=0,p=s.type;if("raw"===s.type&&(u=BigInt(s.node.byteLength),h=BigInt(s.node.byteLength),c=BigInt(s.node.byteLength),f=BigInt(s.node.byteLength),d=1),"directory"===s.type&&(u=0n,h=BigInt(s.unixfs.marshal().byteLength),c=0n,f=h,d=1,o=s.unixfs.mode,a=s.unixfs.mtime,l=s.unixfs),"file"===s.type){let e=await Fa(i.cid,t,r);u=s.unixfs.fileSize(),h=BigInt((s.node.Data?.byteLength??0)+s.node.Links.reduce(((e,t)=>e+(t.Tsize??0)),0)),c=BigInt(e.localFileSize),f=BigInt(e.localDagSize),d=e.blocks,o=s.unixfs.mode,a=s.unixfs.mtime,l=s.unixfs}return{cid:i.cid,mode:o,mtime:a,fileSize:u,dagSize:h,localFileSize:c,localDagSize:f,blocks:d,type:p,unixfs:l}}async function Fa(e,t,n){let r={localFileSize:0,localDagSize:0,blocks:0};if(await t.has(e,n)){let i=await t.get(e,n);if(r.blocks++,r.localDagSize+=i.byteLength,e.code===mn)r.localFileSize+=i.byteLength;else{if(e.code!==ft)throw new So(`${e.toString()} was neither DAG_PB nor RAW`);{let s=pt(i);if(s.Links.length>0)for(let e of s.Links){let i=await Fa(e.Hash,t,n);r.localFileSize+=i.localFileSize,r.localDagSize+=i.localDagSize,r.blocks+=i.blocks}else{if(null==s.Data)throw new Eo(`PBNode ${e.toString()} had no data`);let t=sr.unmarshal(s.Data);if(null==t.data)throw new Eo(`UnixFS node ${e.toString()} had no data`);r.localFileSize+=t.data.byteLength??0}}}}return r}var $a=ko.bind({ignoreUndefined:!0}),Ra=Do("helia:unixfs:touch"),Oa={recursive:!1,shardSplitThresholdBytes:262144},Ma=class{components;constructor(e){this.components=e}async*addAll(e,t={}){yield*async function*(e,t,n={}){yield*Kr(e,t,{...Yr,...n})}(e,this.components.blockstore,t)}async addBytes(e,t={}){return async function(e,t,n={}){let{cid:r}=await async function(e,t,n={}){return Jr({content:e},t,n)}(e,t,{...Yr,...n});return r}(e,this.components.blockstore,t)}async addByteStream(e,t={}){return async function(e,t,n={}){let{cid:r}=await async function(e,t,n={}){return Jr({content:e},t,n)}(e,t,{...Yr,...n});return r}(e,this.components.blockstore,t)}async addFile(e,t={}){return async function(e,t,n={}){let{cid:r}=await Jr(e,t,{...Yr,...n});return r}(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return async function(e,t,n={}){let{cid:r}=await async function(e,t,n={}){let r=await _(Kr([e],t,n));if(null==r)throw(0,k.default)(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return r}({...e,path:e.path??"-"},t,{...Yr,...n});return r}(e,this.components.blockstore,t)}async*cat(e,t={}){yield*async function*(e,t,n={}){let r=ya(wa,n),i=await da(e,r.path,t,r),s=await bo(i.cid,t,r);if("file"!==s.type&&"raw"!==s.type)throw new Io;if(null==s.content)throw new Co;yield*s.content(r)}(e,this.components.blockstore,t)}async chmod(e,t,n={}){return async function(e,t,n,r={}){let i=ga(ba,r),s=await da(e,i.path,n,r);if(ma("chmod %c %d",s.cid,t),i.recursive){let o=await Xs((async function*(){for await(let e of vo(s.cid,n,r)){let n,r=[];if("raw"===e.type)n=new sr({type:"file",data:e.node});else{if("file"!==e.type&&"directory"!==e.type)throw new xo;n=e.unixfs,r=e.node.Links}n.mode=t;let i={Data:n.marshal(),Links:r};yield{path:e.path,content:i}}}),(t=>Kr(t,n,{...i,dagBuilder:async function*(t,n){for await(let r of t)yield async function(){let t=r.content,s=dt(t),o=await Ho(s,n,{...i,cidVersion:e.version});if(null==t.Data)throw new Eo(`${o} had no data`);let a=sr.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:r.path,unixfs:a}}}})),(async e=>Zr(e)));if(null==o)throw new So(`Could not chmod ${s.cid.toString()}`);return pa(o.cid,s,n,i)}let o,a=await n.get(s.cid,r),l=[];if(s.cid.code===mn)o=new sr({type:"file",data:a});else{let e=pt(a);if(null==e.Data)throw new Eo(`${s.cid.toString()} had no data`);l=e.Links,o=sr.unmarshal(e.Data)}o.mode=t;let u=dt({Data:o.marshal(),Links:l}),h=await Nn.digest(u),c=Fe.create(s.cid.version,ft,h);return await n.put(c,u),pa(c,s,n,i)}(e,t,this.components.blockstore,n)}async cp(e,t,n,r={}){return async function(e,t,n,r,i={}){let s=va(_a,i);if(n.includes("/"))throw new To("Name must not have slashes");let[o,a]=await Promise.all([ua(t,r,s),ha(e,n,r,s)]);return ka('Adding %c as "%s" to %c',e,n,t),(await sa(o,a,r,{allowOverwriting:s.force,cidVersion:t.version,...s})).cid}(e,t,n,this.components.blockstore,r)}async*ls(e,t={}){yield*async function*(e,t,n={}){let r=xa(Ea,n),i=await da(e,r.path,t,r),s=await bo(i.cid,t);if("file"!==s.type&&"raw"!==s.type){if(null==s.content)throw new Co;if("directory"!==s.type)throw new Ao;yield*s.content({offset:n.offset,length:n.length})}else yield s}(e,this.components.blockstore,t)}async mkdir(e,t,n={}){return async function(e,t,n,r={}){let i=Sa(Ba,r);if(t.includes("/"))throw new To("Path must not have slashes");if("directory"!==(await bo(e,n,r)).type)throw new Ao(`${e.toString()} was not a UnixFS directory`);Na("creating %s",t);let s=dt({Data:new sr({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]}),o=await Nn.digest(s),a=Fe.create(i.cidVersion,ft,o);await n.put(a,s);let[l,u]=await Promise.all([ua(e,n,i),ha(a,t,n,i)]);return Na("adding empty dir called %s to %c",t,e),(await sa(l,u,n,{...i,allowOverwriting:i.force})).cid}(e,t,this.components.blockstore,n)}async rm(e,t,n={}){return za(e,t,this.components.blockstore,n)}async stat(e,t={}){return Ua(e,this.components.blockstore,t)}async touch(e,t={}){return async function(e,t,n={}){let r=$a(Oa,n),i=await da(e,r.path,t,r),s=r.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(Ra("touch %c %o",i.cid,s),r.recursive){let n=await Xs((async function*(){for await(let e of vo(i.cid,t)){let t,n;if("raw"===e.type)t=new sr({data:e.node}),n=[];else{if("file"!==e.type&&"directory"!==e.type)throw new xo;t=e.unixfs,n=e.node.Links}t.mtime=s;let r={Data:t.marshal(),Links:n};yield{path:e.path,content:r}}}),(n=>Kr(n,t,{...r,dagBuilder:async function*(t,n){for await(let i of t)yield async function(){let t=i.content,s=dt(t),o=await Ho(s,n,{...r,cidVersion:e.version});if(null==t.Data)throw new Eo(`${o} had no data`);let a=sr.unmarshal(t.Data);return{cid:o,size:BigInt(s.length),path:i.path,unixfs:a}}}})),(async e=>Zr(e)));if(null==n)throw new So(`Could not chmod ${i.cid.toString()}`);return pa(n.cid,i,t,r)}let o,a=await t.get(i.cid,n),l=[];if(i.cid.code===mn)o=new sr({data:a});else{let e=pt(a);if(l=e.Links,null==e.Data)throw new Eo(`${i.cid.toString()} had no data`);o=sr.unmarshal(e.Data)}o.mtime=s;let u=dt({Data:o.marshal(),Links:l}),h=await Nn.digest(u),c=Fe.create(i.cid.version,ft,h);return await t.put(c,u),pa(c,i,t,r)}(e,this.components.blockstore,t)}};async function*ja(){throw new Error("Not supported in browsers")}function Va(e,t){return{path:decodeURIComponent(new URL(e).pathname.split("/").pop()??""),content:Ha(e,t)}}async function*Ha(e,t){let n=await globalThis.fetch(e,t);if(null==n.body)throw new So("HTTP response did not have a body");let r=n.body.getReader();try{for(;;){let{done:e,value:t}=await r.read();if(e)return;null!=t&&(yield t)}}finally{r.releaseLock()}}function Ga(e){return new Ma(e)}return(e=>l(t({},"__esModule",{value:!0}),e))(v)})();return e}));